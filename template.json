{
  "nodes": [
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM ctrl_contratos WHERE to_date(\"DTE_CHAVES\", 'DD/MM/YYYY') IN (CURRENT_DATE + INTERVAL '1 year', CURRENT_DATE - INTERVAL '1 year') AND to_date(\"DTE_CHAVES\", 'DD/MM/YYYY') IS NOT NULL;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        40,
        -2180
      ],
      "id": "bb27e6e9-fbb4-4b69-b23e-5d1514c99ecb",
      "name": "1 YEAR",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \"ctrl_contratos.DTE_CHAVES\" FROM ctrl_contratos WHERE to_date(\"DTE_CHAVES\", 'DD/MM/YYYY') IN (CURRENT_DATE + INTERVAL '6 month', CURRENT_DATE - INTERVAL '6 month') AND to_date(\"DTE_CHAVES\", 'DD/MM/YYYY') IS NOT NULL;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        40,
        -2000
      ],
      "id": "58a26338-d446-489d-9797-479293ffc8a3",
      "name": "6 MONTH",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM ctrl_contratos WHERE to_date(\"DTE_CHAVES\", 'DD/MM/YYYY') IN (CURRENT_DATE + INTERVAL '1 month', CURRENT_DATE - INTERVAL '1 month') AND to_date(\"DTE_CHAVES\", 'DD/MM/YYYY') IS NOT NULL;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        40,
        -1780
      ],
      "id": "86b0e1c5-46ba-4d9f-820c-25b824148b6a",
      "name": "1 MONTH",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        320,
        -2000
      ],
      "id": "0ab89d4c-77c5-499d-8bab-f8c49f479a02",
      "name": "Merge Informations"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.text.message }};{{ $json.Hour }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1120,
        -1720
      ],
      "id": "e0237b66-3d51-489e-8c13-7ff985f72f33",
      "name": "Postgres Chat Memory1",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.DTE_CHAVES }}",
        "options": {
          "systemMessage": "=### Identidade\n\nVocê é Lia, uma agente especializada pós venda da imobiliárioa Japi.\n\n## Objetivo\nSeu objetivo é interpretar as informações que chegarem a você a agir de acordo o ordenado em #### COMPORTAMENTO.\n\n## TOOLS A SEU DISPOR\n- calculator, caso precise fazer cálculos.\n- messageAI, use para criar a mensagem para seu cliente.\n\n### Tom de voz\n\n- Moderno, empático e colaborativo.\n- Ao mesmo tempo, a marca deve refletir proximidade com seus clientes e agentes, criando uma sensação de conforto e segurança.\n- O discurso deve ser humano e acessível.\n\n## REGRAS\n- Sempre cumprimentar o cliente de forma cordial e solicitar como pode ajudar.\n- Respeitar a privacidade e a confidencialidade das informações do cliente.\n- Nunca fornecer informações falsas ou enganosas sobre os imóveis ou processos legais.\n- Nunca forneca informações sigilosas da empresa ou de outros clientes.\n- O seu ouput será sempre e somente a mensagem que foi criado com a tool \"messageAI\", nao inclua nada no output alem da mensagem formado por ela. Isso inclui colocar aspas na mensagem\n- Siga as ordens dadas a você a risca\n- Jamais passe as informações de um cliente para outro cliente.\n- Jamais forneça o endereço completo do imóvel.\n- Nunca fornecer informações falsas ou enganosas sobre os imóveis ou processos legais.\n- Caso você não saiba alguma resposta, diga que irá questionar o responsável e logo entra em contato.\n\n#### COMPORTAMENTO\nVocê irá primeiro calcular a data que chegou para você e checar os seguintes parametros:\n\n- Se a data equivale igualmente a diferença de um mês da data atual {{ $now }}, siga o formato DD/MM/YYYY para fazer o cálculo. \nConsidere o mes de fevereiro tem apenas 28 dias.\n\nCaso o valor seja igual a um mês:\nVocê irá mandar uma mensagem para a tool \"messageAi\", seguindo os seguintes parametros de envio.\n\nMensagem - \"O tempo de diferença é de 1 mês\"\nNome do cliente: {{ $json.nome_do_cliente }}\n\n- Se a data equivale igualmente a diferença de 6 meses da data atual {{ $now }}, siga o formato DD/MM/YYYY para fazer o cálculo. \nConsidere o mes de fevereiro tem apenas 28 dias.\n\nCaso o valor seja igual a 6 meses:\nVocê irá mandar uma mensagem para a tool \"messageAi\", seguindo os seguintes parametros de envio.\n\nMensagem - \"O tempo de diferença é de 6 meses\"\nNome do cliente: {{ $json.nome_do_cliente }}\n\n- Se a data equivale igualmente a diferença de um mês da data atual {{ $now }}, siga o formato DD/MM/YYYY para fazer o cálculo. \nConsidere o mes de fevereiro tem apenas 28 dias.\n\nCaso o valor seja igual a um ano:\nVocê irá mandar uma mensagem para a tool \"messageAi\", seguindo os seguintes parametros de envio.\n\nMensagem - \"O tempo de diferença é de 1 ano\"\nNome do cliente: {{ $json.nome_do_cliente }}\n\n#REGRA PARA ESSE COMPORTAMENTO\nO \"response\" da tool \"messageAI\" será seu unico e exclusivo output. Não incluir nada além da mensagem da tool, isso inclui não incluir aspas no seu ouput.\n\n## Contexto - Cerébro para a IA\nIMOBILIÁRIA JAPI\n\nQuem é a empresa - Com mais de duas décadas de tradição, a Imobiliária Japi nasceu com o compromisso de oferecer uma experiência única através de um serviço de excelência em cada etapa da sua jornada de compra e venda. Aqui entendemos que cada cliente é único e merece um atendimento único e personalizado.\n\nMissão: \nRealizar sonhos através de um serviço de excelência. \nNa Japi todo cliente é único!\n\nVisão: \nSer a imobiliária número 1 em atendimento, com um serviço humanizado, reconhecida pela sua qualidade e resultados na cidade de Jundiaí e Região.\n\nNossos Valores:\nHonestidade -  Clareza e ética pautam todas as nossas ações.\nResiliência - Não medimos esforços para realizar os objetivos dos nossos clientes.\nParceria – O cliente sempre em primeiro lugar.\nUnião – Na imobiliária Japi somos uma família.\nEvolução contínua - Aprimoramento constante dos nossos serviços.\nFoco em você – Oferecemos a melhor experiência do mercado imobiliário de Jundiaí e região, buscando a perfeição em cada detalhe.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1140,
        -2000
      ],
      "id": "b0e042ae-6891-412e-a2c2-4bcf14cbf86b",
      "name": "FLUXO PÓS VENDA"
    },
    {
      "parameters": {
        "content": "## NEWSLETTER",
        "height": 660,
        "width": 2780
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -260,
        -2980
      ],
      "id": "68811492-8a69-429e-8103-8f4c7350a756",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 10,
              "triggerAtMinute": 20
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -160,
        -2180
      ],
      "id": "533d544b-5410-432d-8678-e8eadcff43e3",
      "name": "TRIGGER 9H15"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 10,
              "triggerAtMinute": 10
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -160,
        -2000
      ],
      "id": "01e2e505-1668-4c6f-a6a8-19bb6c0d0899",
      "name": "6 MONTH TRIGGER"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 10
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -180,
        -1780
      ],
      "id": "6e7ca2c1-5298-428e-8c54-546a65342327",
      "name": "1 MONTH TRIGGER"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3DD125DF4D24C0040E1D9A31D728A9CF/token/1C60CA6A6C84B1ACA9C97D24/send-text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('Merge Informations').item.json.TELEFONE }}"
            },
            {
              "name": "message",
              "value": "={{ $('FLUXO PÓS VENDA').item.json.output }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2280,
        -2000
      ],
      "id": "d0f92307-3b5f-4c41-b47a-705d1e1a07a6",
      "name": "SEND MESSAGE PÓS VENDA",
      "alwaysOutputData": true,
      "credentials": {
        "httpHeaderAuth": {
          "id": "DbFCXs2KMbRml0Iu",
          "name": "WHATSAPP Z-API JAPI"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        1400,
        -1720
      ],
      "id": "44a6c2c7-33f5-4662-8d1a-c0a44027f422",
      "name": "DATA CALCULATOR"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {
          "frequencyPenalty": 0.4,
          "maxTokens": 300,
          "presencePenalty": 0.5,
          "temperature": 0.6,
          "topP": 0.7
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        960,
        -1720
      ],
      "id": "2052e0a1-4d0b-4576-9721-b5815f84bfc1",
      "name": "OpenAI Chat FLUXO",
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      }
    },
    {
      "parameters": {
        "name": "messageAI",
        "description": "Chame essa tool para criar uma mensagem para o seu cliente ou de acordo com a sua necessidade",
        "workflowId": {
          "__rl": true,
          "value": "fowJ11Fgk5tjQVJP",
          "mode": "list",
          "cachedResultName": "MESSAGE CREATOR AGENT"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "Mensagem": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Mensagem', ``, 'string') }}",
            "Nome do Cliente": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Nome_do_Cliente', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Mensagem",
              "displayName": "Mensagem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "Nome do Cliente",
              "displayName": "Nome do Cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        1260,
        -1720
      ],
      "id": "b43f75d4-0de6-4d9f-b128-fbe3b03810be",
      "name": "CRIADOR DE MENSAGEM"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT into \"chat_histories\" (\"telefone\", \"y_message\") values ({{ $('Merge Informations').item.json.TELEFONE }}, '{{ $json.output }}')",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        2000,
        -2000
      ],
      "id": "6a5384b8-0ece-419d-bf6d-12418adca628",
      "name": "UPTADE CHAT HISTORY",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE ctrl_usuarios\nSET clnt_status = 'CONTATADO POS VENDA'\nWHERE telefone = {{ $('Loop Over Items').item.json.TELEFONE }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        2520,
        -2000
      ],
      "id": "c64bf87e-b5ce-44c7-8feb-9654db6bb804",
      "name": "UPTADE STATUS",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "content": "#### PÓS VENDA\n",
        "height": 760,
        "width": 3080,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -260,
        -2280
      ],
      "id": "711822d5-80bf-4e67-a3ad-3788473499c9",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        920,
        -2000
      ],
      "id": "4476264e-1894-462e-bfed-a183d811ed1a",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1140,
        -2160
      ],
      "id": "acc92367-3b9f-4119-adcb-d768cf63d1d1",
      "name": "No Operation, do nothing2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DO $$\nBEGIN\n    IF (SELECT COUNT(telefone) FROM dados_cliente WHERE telefone = '{{ $('Loop Over Items').item.json.TELEFONE }}') <= 0 THEN\n        INSERT INTO dados_cliente (telefone) VALUES ('{{ $('Loop Over Items').item.json.TELEFONE }}');\n    END IF;\nEND $$;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1640,
        -2000
      ],
      "id": "8515d3cb-94c6-4b8a-b9d4-17befb928e6c",
      "name": "CREATE A USER IF DOESN'T EXIST",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 10 1 * *"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        180,
        -2860
      ],
      "id": "60f5af7e-8d6f-447b-b727-dd41f9d0cd6e",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/responses",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 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"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n        \"model\": \"gpt-4o-mini\",\n        \"tools\": [{\"type\": \"web_search_preview\"}],\n        \"input\": \" Acesse os sites abaixo e busque somente as 3 informações mais relevantes de cada um sobre o mercado imobiliário para pessoas que tem interesse de compra ou locação de imóveis. Não traga apenas a headline, mas acesse as notícias e traga um resumo das mais releventes. Sua resposta será usada por um redator que vai criar uma newsletter. Busque apenas as notícias somente do mês atual. Considere hoje como {{ $now}}. Siga a ordem abaixo de busca:\\n\\n1: https://www.infomoney.com.br/tudo-sobre/mercado-imobiliario/\\n\\n2:https://imobireport.com.br/\\n\\n3:https://sampi.net.br/jundiai\"\n    }",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        180,
        -2700
      ],
      "id": "ba969f75-eed2-4f36-ae79-35c0270fbe54",
      "name": "Busca GPT"
    },
    {
      "parameters": {
        "operation": "sendAndWait",
        "sendTo": "erickferrigatti@imobiliariajapi.com.br",
        "subject": "APROVAÇÃO CONTEUDO NEWSLETTER",
        "message": "={{ $json.output[1].content[0].text }}",
        "responseType": "customForm",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Aprovado?"
            },
            {
              "fieldLabel": "Links aprovados"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        480,
        -2700
      ],
      "id": "d408a5aa-4219-4814-b034-5fdf8592a446",
      "name": "Gmail",
      "webhookId": "4054e57a-90c7-4a15-bef6-bda4772106d1",
      "credentials": {
        "gmailOAuth2": {
          "id": "tsC5rlIt82tns664",
          "name": "GMAIL CREDENTIAL JAPI"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        960,
        -2720
      ],
      "id": "b6e12e08-5f89-4f62-ae57-e006bedef9dd",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "operation": "sendAndWait",
        "sendTo": "erickferrigatti@imobiliariajapi.com.br",
        "subject": "APROVAÇÃO CONTEUDO NEWSLETTER",
        "message": "={{ $json.output[1].content[0].text }}",
        "responseType": "customForm",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Aprovado?"
            },
            {
              "fieldLabel": "CONTEUDO APROVADO?"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1340,
        -2720
      ],
      "id": "e9b446af-942e-4664-a816-c7920ca63d2c",
      "name": "Gmail1",
      "webhookId": "4054e57a-90c7-4a15-bef6-bda4772106d1",
      "credentials": {
        "gmailOAuth2": {
          "id": "tsC5rlIt82tns664",
          "name": "GMAIL CREDENTIAL JAPI"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c0d5bd6b-76fe-485d-a7ae-b40166758942"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "APROVADO"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fffde032-edda-4477-a2f9-4d754d441256",
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "REPROVADO"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        640,
        -2700
      ],
      "id": "0fb457c8-4b2c-452e-aad9-9dada0bdb6c8",
      "name": "Switch"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1000,
        -2500
      ],
      "id": "6bdc153d-cd9c-43da-a7b2-e7a7c6f18ac4",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "189ecf94-e5b6-4059-a41d-891a35cd57b2",
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        940,
        360
      ],
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      }
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data || $json.text || $json.concatenated_data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "=file_id",
                "value": "={{ $('Set File ID').first().json.file_id }}"
              }
            ]
          }
        }
      },
      "id": "41ed9e3f-408f-4276-b92f-5d400e796dc0",
      "name": "Default Data Loader",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        -3160,
        1880
      ],
      "disabled": true
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "d8a832f6-1321-4119-a662-6db3ed38767f",
      "name": "Embeddings OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        -3240,
        1940
      ],
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.file_id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "id": "4f63ec86-4a34-4630-a6b5-a3b559d2112e",
      "name": "Download File",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -4060,
        1660
      ],
      "executeOnce": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "DyYeazVQM65iC343",
          "name": "Google Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "hour": 5
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1urz7y2mxzYzHUE4yE5bTyAYlNWrgc14N",
          "mode": "list",
          "cachedResultName": "D: PROSPEC TERAPEUTA",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1urz7y2mxzYzHUE4yE5bTyAYlNWrgc14N"
        },
        "event": "fileCreated",
        "options": {}
      },
      "id": "9cac25c3-6a35-452a-99c4-c0dc2a63f053",
      "name": "File Created",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -4960,
        1600
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "DyYeazVQM65iC343",
          "name": "Google Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "hour": 4
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1urz7y2mxzYzHUE4yE5bTyAYlNWrgc14N",
          "mode": "list",
          "cachedResultName": "D: PROSPEC TERAPEUTA",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1urz7y2mxzYzHUE4yE5bTyAYlNWrgc14N"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "id": "1a451d8a-5c86-4be0-b2e7-8e3290da6c39",
      "name": "File Updated",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -4960,
        1800
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "DyYeazVQM65iC343",
          "name": "Google Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "id": "0c54fa46-b049-4738-85b3-620add354a61",
      "name": "Extract Document Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -3640,
        1860
      ],
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "d54eb6f8-4255-470a-a8ea-dd5ed91fc0b9",
      "name": "Embeddings OpenAI",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        660,
        480
      ],
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
              "name": "file_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "f4536df5-d0b1-4392-bf17-b8137fb31a44",
              "name": "file_type",
              "value": "={{ $json.mimeType }}",
              "type": "string"
            },
            {
              "id": "c774ed34-0d67-44b7-a537-83810f357b7c",
              "name": "originalFilename",
              "value": "={{ $json.originalFilename }}",
              "type": "string"
            },
            {
              "id": "dff39c85-b4a2-45ba-a5ff-f4b311999efc",
              "name": "sha1Checksum",
              "value": "={{ $json.sha1Checksum }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "8de20f37-a60a-4fe3-8a4b-58b47bc33f27",
      "name": "Set File ID",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4780,
        1640
      ],
      "disabled": true
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "d1fd3d64-97d1-4ff8-866a-094efab1aa47",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -3640,
        1480
      ],
      "disabled": true
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "8efb3fcf-4a8e-4ee4-ae08-d94fd35a0602",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -3500,
        1660
      ],
      "disabled": true
    },
    {
      "parameters": {},
      "id": "57a463cb-c1f3-49bc-809d-390e19aa035a",
      "name": "Character Text Splitter",
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        -3020,
        1980
      ],
      "disabled": true
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "c212e63f-58bc-41fe-ad66-068325180c91",
      "name": "Summarize",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        -3360,
        1660
      ],
      "disabled": true
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "71fb169c-4e8b-4bd7-83ec-3c984ea0f25a",
      "name": "Insert into Supabase Vectorstore",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        -3180,
        1660
      ],
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "6125b543-7d51-47e4-a7eb-6a3a7309ab39",
      "name": "Supabase Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        640,
        360
      ],
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      }
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "id": "2a73e58e-ac46-45dd-b907-ae2aea1a3bf6",
      "name": "Extract from Excel",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -3640,
        1660
      ],
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Arquivos criados em uma pasta específica > Verificar o tipo de arquivo e realizar conversão > Extrair o texto > Adicionar ao Vector Store",
        "height": 80,
        "width": 1600,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5020,
        2060
      ],
      "typeVersion": 1,
      "id": "58a96214-5ba9-4149-8fdb-ce120ecda3a8",
      "name": "Sticky Note12",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Gatilho de Monitoramento",
        "height": 480,
        "width": 213,
        "color": 5
      },
      "id": "f9168252-5cda-4bc1-84f9-fc34e18fc479",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5000,
        1500
      ],
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e060ee3b-eb05-4df2-b1d7-28b827bb640e",
      "name": "OpenAI3",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        820,
        60
      ],
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "9ad3e073-9b92-4121-9154-e4b9a8f0a230",
      "name": "Loop Over Items3",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1240,
        -100
      ]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"
      },
      "id": "331bae73-1a13-4498-ba9a-1d8c1414ad99",
      "name": "OutputParser1",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        940,
        60
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Whatsapp message to be splitted and formated: {{ $json.output }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=Por favor, gere a saída no seguinte formato JSON:\n{\n  \"messages\": [\n    \"splitedMessage\",\n    \"splitedMessage\",\n    \"splitedMessage\"\n  ]\n}\n\nAs mensagens devem ser divididas de forma natural, afinal estamos conversando com um humano, não é mesmo?\n\nCertifique-se de que a resposta siga exatamente essa estrutura, incluindo os colchetes e as aspas.\n\n### Jamais separe uma mensagem vazia.\n\n### Sempre que tiver um link envie ele de forma separada sem alteração\n\n### Certifique-se de que a resposta siga exatamente essa estrutura abaixo, deixando somente entre '*' para negrito e nunca fugindo das demais regras de markdown do whatsapp:\n\t\t\t- *negrito* (substitua '**' por '*')\n\t\t\t- ~tachado~ (caso seja algo que foi excluído ou alterado)\n\t\t\t- _itálico_.(extremamente raro)\n            - `link` (usar sempre em todos os links)"
            }
          ]
        }
      },
      "id": "55ecd356-7dda-4ade-b74a-9109cd891cf0",
      "name": "Parser  Chain",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        780,
        -100
      ]
    },
    {
      "parameters": {
        "content": "# Divisão de Mensagens Inteligente - Texto",
        "height": 120,
        "width": 736,
        "color": 5
      },
      "id": "8d7f96c0-762c-4123-8046-a52cbc490ead",
      "name": "Sticky Note19",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        580,
        -360
      ]
    },
    {
      "parameters": {
        "content": "# Gera/Consulta sessionId",
        "height": 460,
        "width": 596,
        "color": 5
      },
      "id": "a1e69029-6563-4a74-be64-63509a9dfc7e",
      "name": "Sticky Note23",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3140,
        -220
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6020,
        -220
      ],
      "typeVersion": 1,
      "id": "e37456c5-4eae-4c3d-9215-fa3bf29737b2",
      "name": "Sticky Note31"
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6380,
        0
      ],
      "typeVersion": 1,
      "id": "82544836-398b-44ce-9db2-60e3e18038d0",
      "name": "Sticky Note33"
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6020,
        220
      ],
      "typeVersion": 1,
      "id": "245ec935-eca5-4285-85a2-8cf12645123d",
      "name": "Sticky Note37"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Code1').first().json.sessionId }}",
        "contextWindowLength": 100
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -200,
        -380
      ],
      "id": "3d8fb67a-55e5-44b2-aee0-ff806f7f01bf",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "content": "# Dados",
        "height": 80,
        "width": 150,
        "color": 5
      },
      "id": "3ff729df-ef26-4655-ad16-d755caf6cffe",
      "name": "Sticky Note43",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3740,
        -200
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        1260,
        -600
      ],
      "id": "b2615469-3494-4040-88d8-ca64bbff87bd",
      "name": "Merge1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "defac08a-6745-422b-bb05-90da9f47d91b",
              "leftValue": "={{ $('Busca Telefone').last().json.values() }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        800,
        -640
      ],
      "id": "b6d0d065-ff0e-494f-8e14-b227e425ca64",
      "name": "If4"
    },
    {
      "parameters": {
        "content": "# Cadastra Chat Supabase",
        "height": 100,
        "width": 450,
        "color": 5
      },
      "id": "f003fb71-ff94-4a10-9415-ae40bd5beea3",
      "name": "Sticky Note55",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        400,
        -780
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "app",
              "condition": "eq",
              "keyValue": "lia"
            },
            {
              "keyName": "updated_at",
              "condition": "gt",
              "keyValue": "={{ $now.plus(5,'minutes') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -4840,
        640
      ],
      "id": "e48ec2d9-1974-4451-8c3a-ef0b2b87fea2",
      "name": "ListChats-Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "chat_messages",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $json.phone }}"
            },
            {
              "keyName": "active",
              "condition": "eq",
              "keyValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -4440,
        660
      ],
      "id": "21fc71f2-be34-49f8-87f3-643d409b3d35",
      "name": "ListMessages-Supabase",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "chat_messages",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Aggregate1')?.item?.json?.conversas?.last()?.phone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "active",
              "fieldValue": "false"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3040,
        760
      ],
      "id": "7d0b1be0-3089-401d-ad6e-bb92c7ed99c4",
      "name": "DisableMessage-Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9c00627-84a9-49a9-bc7e-d923a5918346",
              "name": "output",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "0e34f673-b6dc-4748-89d2-a178dfe91853",
              "name": "phone",
              "value": "={{ $('Aggregate1').item.json.conversas.last().phone }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3320,
        460
      ],
      "id": "033a7096-d224-48fc-8c29-a8c70de6a443",
      "name": "SetConfig",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Você é um agente facilitador de vendas e está buscando conversas não finalizadas entre o cliente e um agent de IA. \n\n# Cria a responda apenas a resposta não precisa justificar sua resposta\n\n# Identifique o cliente não enviou mais mensagens de resposta\n\n# Se o cliente não responder mesmo assim, agradeça e diga que irá encerrar o pedido e está a disposição para outros pedidos\n\n# Use frase simples e naturais como nos exemplos\n\nExemplos : \n - 'Oi .. ainda está ai'\n - 'E ai ? vamos finalizar o pedido?' \n\n# Conversa entre o cliete e o agente de IA:\n{{ $json.texto }}"
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        -3640,
        460
      ],
      "id": "da8dd9e6-d54c-43cb-aeb8-f1b38a58dc21",
      "name": "Basic LLM Chain",
      "disabled": true
    },
    {
      "parameters": {
        "inputText": "={{ $json.texto }}",
        "categories": {
          "categories": [
            {
              "category": "pendente_resposta",
              "description": "A conversa está pendente devido a uma informação que o cliente ficou de fornecer ou confirmar, ou está pendende de marcar a reunião"
            },
            {
              "category": "encerrada",
              "description": "Houve um desfecho da conversa  ouagendamento de uma reuniãoe o agente de IA se despediu"
            },
            {
              "category": "sem_resposta",
              "description": "=Se o cliente não respondeu mais as mensagens do agente - mensagem do cliente vazia"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -3960,
        660
      ],
      "id": "2bc85a23-af8e-4546-b75d-4821f52ca7db",
      "name": "Text Classifier",
      "disabled": true
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "conversas",
        "include": "specifiedFields",
        "fieldsToInclude": "id,message_type,created_at,user_message, bot_message,phone, conversation_id",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -4280,
        660
      ],
      "id": "bf693940-1908-46da-a95f-356521f863af",
      "name": "Aggregate1",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "return $('Aggregate1').all().map(item => {\n  // Tenta acessar a propriedade 'conversas' e verifica se ela é um array\n  const conversas = item.json.conversas || []; // Garante que é pelo menos um array vazio\n\n  if (!Array.isArray(conversas)) {\n    throw new Error(\"A propriedade 'conversas' não é um array.\");\n  }\n\n  // Processa cada conversa e verifica as mensagens\n  const textoUnico = conversas.map(conversa => {\n    const cliente = conversa.user_message || \"sem mensagem do chatbot\";\n    const agente = conversa.bot_message || \"sem resposta\";\n    \n    // Verifica se a data existe e formata\n    const dataOriginal = conversa.created_at || \"Data da Mensagem indisponível\";\n    const dataFormatada = dataOriginal !== \"Data da Mensagem indisponível\"\n      ? formatarData(dataOriginal)\n      : dataOriginal;\n\n    return `em: ${dataFormatada}\\n\\n - agente(chatbot): ${agente} \\n - cliente: ${cliente}\\n`;\n  }).join('\\n\\n');\n\n  // Retorna o texto final como resultado\n  return {\n    json: {\n      texto: textoUnico\n    }\n  };\n});\n\n// Função para formatar a data\nfunction formatarData(dataString) {\n  const data = new Date(dataString); // Converte a string em objeto Date\n  if (isNaN(data)) {\n    return \"Data inválida\"; // Retorna se a data não for válida\n  }\n  \n  // Formata no padrão DD/MM/YYYY HH:mm\n  const dia = String(data.getDate()).padStart(2, '0');\n  const mes = String(data.getMonth() + 1).padStart(2, '0'); // Mês começa em 0\n  const ano = data.getFullYear();\n  const horas = String(data.getHours()).padStart(2, '0');\n  const minutos = String(data.getMinutes()).padStart(2, '0');\n  \n  return `${dia}/${mes}/${ano} ${horas}:${minutos}`;\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4100,
        660
      ],
      "id": "d1aa2350-a08a-4854-bd1d-fdd1360eef00",
      "name": "Code4",
      "disabled": true
    },
    {
      "parameters": {
        "tableId": "chat_messages",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Aggregate1').item.json.conversas.last().phone }}"
            },
            {
              "fieldId": "conversation_id",
              "fieldValue": "={{ $('Aggregate1').item.json.conversas.last().phone }}"
            },
            {
              "fieldId": "message_type",
              "fieldValue": "={{ $('Aggregate1').item.json.conversas.last().message_type }}"
            },
            {
              "fieldId": "bot_message",
              "fieldValue": "={{ $json.text }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3320,
        640
      ],
      "id": "a81729ec-782c-4283-8c32-d381550a18bc",
      "name": "Supabase2",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -4640,
        640
      ],
      "id": "65291450-4063-4a30-96ac-d38cfd0632a7",
      "name": "Loop Over Items2",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -3480,
        600
      ],
      "id": "fe63730d-daf2-4b08-989b-7b317e8fea7e",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -3180,
        760
      ],
      "id": "da35cafa-486e-4214-88ae-823697b25083",
      "name": "Wait2",
      "webhookId": "cd1f35d3-c129-4957-a72b-9f1fea576935",
      "disabled": true
    },
    {
      "parameters": {
        "content": "",
        "height": 140,
        "width": 480,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5040,
        440
      ],
      "typeVersion": 1,
      "id": "7ba39038-6c5d-4f80-9ae3-e07df25fda60",
      "name": "Sticky Note58",
      "disabled": true
    },
    {
      "parameters": {
        "content": "# Follow up Whatsapp",
        "height": 80,
        "width": 393,
        "color": 5
      },
      "id": "ce38ff34-661b-4696-b22e-2152353379d8",
      "name": "Sticky Note59",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5020,
        460
      ],
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -3960,
        820
      ],
      "id": "0298a144-2b0e-4dd8-a70c-59773f625cf4",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "keyValue": "={{ $('Variáveis').first().json.telefone }}"
            },
            {
              "keyName": "app",
              "keyValue": "teste"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        660,
        -640
      ],
      "id": "7b052116-b6db-4d74-a474-ce3482177b9b",
      "name": "Busca Telefone",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "tableId": "chats",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Variáveis').first().json.telefone }}"
            },
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now}}"
            },
            {
              "fieldId": "conversation_id",
              "fieldValue": "={{ $('Code1').first().json.sessionId }}"
            },
            {
              "fieldId": "app",
              "fieldValue": "terapeuta"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1040,
        -700
      ],
      "id": "b498caa8-0cc3-4a17-b71b-c89265cbe040",
      "name": "Adiciona CHAT supabase",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Variáveis').first().json.telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1040,
        -540
      ],
      "id": "387309fd-929f-499b-b876-911bdd496e05",
      "name": "Atualiza CHAT Supabase",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      }
    },
    {
      "parameters": {
        "tableId": "chat_messages",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $json.phone }}"
            },
            {
              "fieldId": "conversation_id",
              "fieldValue": "={{ $json.phone }}"
            },
            {
              "fieldId": "bot_message",
              "fieldValue": "={{ $('LIA SDR').first().json.output }}"
            },
            {
              "fieldId": "user_message",
              "fieldValue": "={{ $('Mensagem Completa').item.json.mensagem_completa }}"
            },
            {
              "fieldId": "message_type",
              "fieldValue": "={{ $('dados_para_atendimento_humano1').first().json.message.content_type }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1440,
        -600
      ],
      "id": "3d8f1dd4-3ac2-453d-81f8-fae15c1d7e86",
      "name": "Cria Histórico Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7c4cdb12-9452-42a6-a39a-c268bd38dce1",
              "leftValue": "={{ $json.output.lenght }}",
              "rightValue": 90,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        640,
        -180
      ],
      "id": "69728848-638e-427e-ae9b-cb41ef22cf47",
      "name": "Menos que 240 Caracteres"
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.messages",
        "options": {
          "destinationFieldName": "output"
        }
      },
      "id": "206cd52a-47ff-4890-93ed-6ad45c762be9",
      "name": "Split de Mensagem",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1080,
        -100
      ]
    },
    {
      "parameters": {
        "amount": 1
      },
      "id": "546f480c-3ecc-4f43-8c66-f27471ecec8c",
      "name": "1 segundo",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1600,
        -80
      ],
      "webhookId": "2ec24a1a-31fc-49f0-8e2f-532b131f1bd9"
    },
    {
      "parameters": {
        "jsCode": "return $items(\"Set File ID\").map(item => {\n  return {\n    json: {\n      file_id: item.json.file_id,\n      file_type: item.json.file_type\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4420,
        1640
      ],
      "id": "d2b4d336-0ad4-4382-a418-c9cc405c4489",
      "name": "Retorna ID do arquivo",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $json.file_id }}*"
      },
      "id": "57b96012-dfe9-4ea0-a319-959ad182cc55",
      "name": "Deleta linhas antigas do documento",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -4620,
        1640
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create table dados_cliente (\n  id bigserial primary key,\n  created_at TIMESTAMPTZ, \n  telefone text, \n  sessionid text\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -6320,
        -200
      ],
      "id": "8f9f9e89-f567-41aa-b14b-ef1e08dc1907",
      "name": "Cria Tabela Dados Cliente",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Create a table to store your documents\ncreate table documents (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -6320,
        240
      ],
      "id": "1d55fd1e-c994-40a7-bb53-a5f4c9871eb2",
      "name": "Cria Tabela Documentos",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from documents",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -5960,
        240
      ],
      "id": "9a822fd4-e635-4dce-886f-074b9c168d22",
      "name": "Deleta Conteúdo Documentos",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6640,
        220
      ],
      "typeVersion": 1,
      "id": "b69666cf-31f3-416c-8801-12e9f74dcff5",
      "name": "Sticky Note40"
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6380,
        220
      ],
      "typeVersion": 1,
      "id": "452c18e5-ff5f-428d-a093-a9c5087eca74",
      "name": "Sticky Note48"
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6640,
        -220
      ],
      "typeVersion": 1,
      "id": "4d7b0894-ae60-4457-96f8-0a42aa3abde6",
      "name": "Sticky Note49"
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6640,
        0
      ],
      "typeVersion": 1,
      "id": "89390109-7447-4947-9248-3072abef4ced",
      "name": "Sticky Note50"
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6020,
        0
      ],
      "typeVersion": 1,
      "id": "a4bd43d8-40db-40d2-ac17-1730a464620f",
      "name": "Sticky Note56"
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6380,
        -220
      ],
      "typeVersion": 1,
      "id": "d2023fda-3ce5-4227-83be-fcea1eede3e4",
      "name": "Sticky Note57"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from n8n_chat_histories",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -5960,
        -200
      ],
      "id": "fde60f90-9a57-4e15-ae0b-59496e8ea2c2",
      "name": "Deleta Histórico",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create function match_documents (\n  query_embedding vector(1536),\n  match_count int default null,\n  filter jsonb DEFAULT '{}'\n) returns table (\n  id bigint,\n  content text,\n  metadata jsonb,\n  similarity float\n)\nlanguage plpgsql\nas $$\n#variable_conflict use_column\nbegin\n  return query\n  select\n    id,\n    content,\n    metadata,\n    1 - (documents.embedding <=> query_embedding) as similarity\n  from documents\n  where metadata @> filter\n  order by documents.embedding <=> query_embedding\n  limit match_count;\nend;\n$$;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -6580,
        240
      ],
      "id": "1413e5f8-a8cf-4afb-a28a-ca276cb241de",
      "name": "Cria função Busca em Vetor",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create extension vector;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -6320,
        20
      ],
      "id": "bde17970-1c75-4490-852d-3061b705492d",
      "name": "Cria Extensão Vetor",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create table chats (\n  id bigserial primary key,\n  created_at TIMESTAMPTZ, \n  phone text,\n  updated_at text, \n  app text,\n  conversation_id text\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -6580,
        20
      ],
      "id": "c82f3dec-1cd5-47d9-b5e3-31b967e6514d",
      "name": "Cria Tabela Chats",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5760,
        0
      ],
      "typeVersion": 1,
      "id": "f1f7da51-31e0-4f51-84c8-18a5a53e56c3",
      "name": "Sticky Note65"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from chats",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -5700,
        20
      ],
      "id": "75cea2e2-89f5-4303-acd4-418057f27969",
      "name": "Deleta Conteúdo Chats",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from dados_cliente",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -5960,
        20
      ],
      "id": "d408d460-f0b8-4bc0-bd94-97c905eec5e6",
      "name": "Deleta Conteúdo Dados Cliente",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5760,
        -220
      ],
      "typeVersion": 1,
      "id": "a755c8f9-e053-4d97-9dae-87f10f91fbf6",
      "name": "Sticky Note66"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from chat_messages",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -5700,
        -200
      ],
      "id": "e00037ac-6634-4390-b70c-990f2ad63165",
      "name": "Deleta Conteúdo Chat_Messages",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE chat_messages (\n  id BIGSERIAL PRIMARY KEY,\n  created_at TIMESTAMPTZ, \n  phone TEXT,\n  conversation_id TEXT, \n  bot_message TEXT,\n  user_message TEXT, \n  message_type TEXT,\n  active BOOLEAN DEFAULT TRUE\n);\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -6580,
        -200
      ],
      "id": "ecbccd6c-2a77-4ed4-9ac9-67f3f7e3dd5b",
      "name": "Cria Tabela Chat_Messages",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "content": "# Webhook",
        "height": 80,
        "width": 196,
        "color": 5
      },
      "id": "45ac81ba-860d-4f66-a361-777dbe469619",
      "name": "Sticky Note67",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5020,
        -200
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Code1').item.json.sessionId }}"
      },
      "id": "f64c25c4-f1ee-4db3-abda-824a52eb7065",
      "name": "Delete Memory",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1600,
        -600
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "content": "# Agendamento",
        "height": 80,
        "width": 283,
        "color": 5
      },
      "id": "03d6b620-1ee0-4216-aef2-0d8e5f3fb0fc",
      "name": "Sticky Note15",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2500,
        500
      ],
      "disabled": true
    },
    {
      "parameters": {},
      "id": "5a9dd325-13d2-44ea-8812-2ad56c51504d",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -2460,
        820
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "be5649a9-7624-4621-bd2d-84c25577c0ce",
              "leftValue": "={{ $json.available }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9d3a4167-b3a8-4e45-ab1a-19b4f34db233",
      "name": "If6",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1760,
        1020
      ],
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "86ff282a-3ede-4417-98c1-0d10858bc5dc",
              "name": "response",
              "value": "=Você já tem uma reunião agendada para o dia: {{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' às')}`;\n})()}} gostaria de reagendar? ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "f6ecacfd-00ca-4cc5-ba49-38f0c003bfaf",
      "name": "Edit Fields6",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1440,
        580
      ],
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8d192ed0-aebd-404e-8339-daab0d29651f",
              "leftValue": "={{ $item(\"0\").$node[\"Já tem um evento\"].json[\"attendees\"][\"0\"][\"email\"] }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "97e288c0-396d-4fe8-98b4-611dffa0dbf8",
      "name": "If5",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1740,
        580
      ],
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7f842ffa-cd8f-40ab-a0a7-40dc173357a7",
              "name": "response",
              "value": "Informe o usuário que o agendamento foi cancelado e que estará sempre à disposição para um novo agendamento.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "bb10382c-1798-4c25-bb3b-0d614a294df6",
      "name": "Edit Fields7",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1460,
        800
      ],
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "04c6ca35-7572-4699-bcb7-bbf2f2a6e6a4",
              "name": "response",
              "value": "horário não disponivel, peça outro horário",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "68bc6be2-a81c-4b58-8ee2-ab7615f0187c",
      "name": "Edit Fields9",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -980,
        800
      ],
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "be5649a9-7624-4621-bd2d-84c25577c0ce",
              "leftValue": "={{ $json.available }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "35964116-9d01-49b1-8928-86d35f3becee",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1280,
        640
      ],
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7f842ffa-cd8f-40ab-a0a7-40dc173357a7",
              "name": "response",
              "value": "=sua reunião foi reagendada para a data:{{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' às')}`;\n})()}} o link da reunião é: {{ $json.hangoutLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "8bacab8e-7bd8-44a9-8319-506a400bea6a",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1080,
        920
      ],
      "disabled": true
    },
    {
      "parameters": {
        "name": "user_documents",
        "description": "Contains all the information about prices and andress that you can check to answer user questions."
      },
      "id": "6375eb56-261c-4a8f-a477-ed8861abf18c",
      "name": "buscar_documentos",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        720,
        240
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "806d2106-d234-428e-a909-db00044fc342",
              "leftValue": "={{ $json.start.dateTime }}",
              "rightValue": "={{ $('Schedule Trigger3').item.json.timestamp.toDateTime().plus(0, minutes) }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "aab42f56-d82f-434d-8319-00e3c2c690f3",
              "leftValue": "={{ $json.start.dateTime }}",
              "rightValue": "={{ $('Schedule Trigger3').item.json.timestamp.toDateTime().plus(5, minutes) }}",
              "operator": {
                "type": "dateTime",
                "operation": "before"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -1820,
        1780
      ],
      "id": "5355ae0e-eff5-4d4f-8236-9fccc72bf589",
      "name": "5 Minutos antes",
      "alwaysOutputData": true,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "806d2106-d234-428e-a909-db00044fc342",
              "leftValue": "={{ $json.start.dateTime }}",
              "rightValue": "={{ $('Schedule Trigger3').item.json.timestamp.toDateTime().plus(115, minutes) }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "aab42f56-d82f-434d-8319-00e3c2c690f3",
              "leftValue": "={{ $json.start.dateTime }}",
              "rightValue": "={{ $('Schedule Trigger3').item.json.timestamp.toDateTime().plus(120, minutes) }}",
              "operator": {
                "type": "dateTime",
                "operation": "before"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -1820,
        1420
      ],
      "id": "82f9a079-84a7-4232-8d43-36ce507f6640",
      "name": "2 Hora antes",
      "alwaysOutputData": true,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5427ed1f-2dd2-4f7c-b7f4-9b13cd780bc7",
              "leftValue": "={{ $json.kind }}",
              "rightValue": "calendar#event",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1620,
        1420
      ],
      "id": "c407cc1d-5594-40c3-a08f-967f7e66c137",
      "name": "If7",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5427ed1f-2dd2-4f7c-b7f4-9b13cd780bc7",
              "leftValue": "={{ $json.kind }}",
              "rightValue": "calendar#event",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1620,
        1780
      ],
      "id": "1e39fa10-9497-4194-b6fa-89fec39f202b",
      "name": "If8",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a5af6299-68f1-4d3a-b2a7-c2ed65aa4ae6",
              "name": "remoteJid",
              "value": "={{ $('Loop Over Items4').item.json.description }}",
              "type": "string"
            },
            {
              "id": "fc721c8e-bfd6-4364-9c30-b0038118856f",
              "name": "Tempo",
              "value": "Crie uma mensagem avisando que falta 2 horas para a reunião ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1380,
        1400
      ],
      "id": "b0be2bea-ab65-44e2-8a46-92636a12fcf4",
      "name": "Edit Fields5",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Edit Fields5').item.json.Tempo }}",
        "options": {
          "systemMessage": "=Você foi acionado pois vai avisar quanto tempo falta para a reunião, diga apenas o tempo que falta e se precisa de algo antes da reunião, sem dicas de uso ou informações extras, exemplo: falta 2 horas para nossa reunião, precisando de qualquer coisa só falara comigo! "
        }
      },
      "id": "3927bc77-43e0-4524-887f-9c26a45595d4",
      "name": "Atendente1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -1040,
        1380
      ],
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Edit Fields2').item.json.Tempo }}",
        "options": {
          "systemMessage": "=Você foi acionado pois vai avisar quanto tempo falta para a reunião, diga apenas o tempo que falta e se precisa de algo antes da reunião, sem dicas de uso ou informações extras, exemplo: nosso time já está entrando na call"
        }
      },
      "id": "43e4c40a-d63e-46b8-89fd-aac4a35941c6",
      "name": "Atendente2",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -1040,
        1780
      ],
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c930cacf-b5ee-4120-a192-d68715d71d57",
              "name": "remoteJid",
              "value": "={{ $('Google Calendar').item.json.description }}",
              "type": "string"
            },
            {
              "id": "e7775c3f-04e5-4b6f-9695-dad8654b7ff8",
              "name": "Tempo",
              "value": "Crie uma mensagem avisando que falta 5 minutos para a reunião ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1420,
        1760
      ],
      "id": "4e59559a-a03e-44ce-852b-1dd16d1e0f78",
      "name": "Edit Fields2",
      "disabled": true
    },
    {
      "parameters": {
        "content": "# AVISO REUNIÃO CHEGANDO",
        "height": 80,
        "width": 551.2183277924504,
        "color": 5
      },
      "id": "c38442c6-f84a-4f4c-9f8a-dc3803f1ab25",
      "name": "Sticky Note27",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2560,
        1320
      ],
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -1060,
        1600
      ],
      "id": "52af7806-377f-4eff-b52d-281a0039d0ec",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "ceb74b7f-60dd-48a3-b317-a166e91e7c9e",
      "name": "Loop Over Items4",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -2060,
        1500
      ],
      "disabled": true
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -480,
        1800
      ],
      "id": "5b1a33da-09c7-47f6-8e14-1b796bbfd8b8",
      "name": "Wait",
      "webhookId": "1652a979-d426-42ae-8458-da1ee045bfb4",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "nr_telefone",
              "keyValue": "={{ $('Variáveis').item.json.telefone }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3120,
        -40
      ],
      "id": "a372cdd4-2a7a-4087-9d26-586f0b15b6fe",
      "name": "Supabase",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
              "leftValue": "={{ $json.telefone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2940,
        -40
      ],
      "id": "d09084fe-4060-4a1f-8249-7e41ecb84b4e",
      "name": "If1"
    },
    {
      "parameters": {
        "action": "generate"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        -2820,
        60
      ],
      "id": "ffc28306-408f-4363-8f62-2c73a4e9da86",
      "name": "Gerar sessionID"
    },
    {
      "parameters": {
        "tableId": "dados_cliente",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "sessionid",
              "fieldValue": "={{ $json.data }}"
            },
            {
              "fieldId": "nr_telefone",
              "fieldValue": "={{ $('Variáveis').item.json.telefone }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2680,
        60
      ],
      "id": "93a2cc30-04ce-41e6-81b8-8c1b7459ab2e",
      "name": "Supabase1",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Obtém os valores dos nós anteriores\nconst sessionid1 = $input.item.json.data;  // Do nó \"Gerar sessionID\"\nconst sessionid2 = $input.item.json.sessionid;  // Do nó \"Supabase\"\n\n// Retorna apenas o que existir, chamando sempre de \"sessionId\"\nreturn [{ sessionId: sessionid1 || sessionid2 || null }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2560,
        -100
      ],
      "id": "dac5c5ec-11dd-4383-8de9-2c2f1f4b9f39",
      "name": "Code1"
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $now }}",
        "format": "custom",
        "customFormat": "dd-MM-yyyy",
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        -3320,
        -40
      ],
      "id": "19446c3b-c4bd-4980-9925-d6363d8baf5c",
      "name": "Date & Time1"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.png",
          "mimeType": "image/png"
        }
      },
      "id": "82194eaf-ebad-46ef-8554-224844dafd0a",
      "name": "Convert to File1",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2200,
        60
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "6aff7369-6548-4115-87b2-ef796a3077f9",
      "name": "Edit Fields3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2340,
        60
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "ade56c50-1520-4760-8df5-e99617d6d3ad",
              "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.imageMessage.caption }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "26a64e9f-0b8e-43cb-9144-cfd9db411538",
      "name": "If3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1900,
        60
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Code1').item.json.sessionId }}",
        "messageData": "={{ $('Webhook EVO').item.json[\"body\"][\"data\"][\"message\"][\"imageMessage\"][\"caption\"] }}, {{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "4aa01b4c-087b-47b3-88c9-847140402e09",
      "name": "Redis4",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1640,
        80
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Code1').item.json.sessionId }}",
        "messageData": "={{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "8b4d89cc-e22b-4bc7-a41c-f8b11f37b21b",
      "name": "Redis5",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1640,
        -60
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "Resumo curto da imagem. Responda sem acento, sem hifens",
        "inputType": "base64",
        "options": {}
      },
      "id": "10d2a2e4-360e-4562-8008-0740e6217ede",
      "name": "OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        -2040,
        60
      ],
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d5a342e9-585b-42ea-be44-644adae10199",
              "leftValue": "={{ $json.Redis2 }}",
              "rightValue": "={{ $json.Redis1 }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d66c318d-b4f2-4c63-967d-d5e674a071d8",
      "name": "Compara Get Memory1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -800,
        -140
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Code1').item.json.sessionId }}",
        "messageData": "={{ $('Webhook').item.json.body.text.message }}",
        "tail": true
      },
      "id": "93f6a728-e515-44cf-ab51-efec9613fa2c",
      "name": "Text Memory1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1640,
        -380
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Code1').item.json.sessionId }}",
        "messageData": "={{ $json.text }}",
        "tail": true
      },
      "id": "048c3236-ed91-4d3b-8781-febb67b93086",
      "name": "Audio Memory1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1640,
        -220
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f336a1ff-e577-489d-a739-1eb8bd509245",
              "name": "Redis2",
              "value": "={{ $json.propertyName }}",
              "type": "string"
            },
            {
              "id": "946d1420-e379-46e3-8fcd-3816340fbabb",
              "name": "Redis1",
              "value": "={{ $('Get Memory 1').item.json.propertyName }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "21e77527-0a08-4f89-bcf4-df95cd5ada69",
      "name": "Edit Fields8",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -980,
        -140
      ]
    },
    {
      "parameters": {
        "amount": 15
      },
      "id": "80fa694c-1a3e-488f-8540-63b1123ef711",
      "name": "Wait3",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1300,
        -140
      ],
      "webhookId": "7508fa49-bc87-45fc-bc55-e92f0d00664a"
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Code1').item.json.sessionId }}",
        "options": {}
      },
      "id": "955a2310-86db-4a56-9703-216cba853f2c",
      "name": "Get Memory 1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1460,
        -140
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Code1').item.json.sessionId }}",
        "options": {}
      },
      "id": "a2a70477-a99b-427c-a74a-1bf3f5d2b0e3",
      "name": "Get Memory 2",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1140,
        -140
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $json.telefone }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2720,
        -100
      ],
      "id": "9fcd17c6-800f-445f-92ab-4a5c326d4500",
      "name": "Get Dados",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8d88c137-383f-4307-b3cc-1f6a560ea67b",
              "name": "telefone",
              "value": "={{ $('Webhook').item.json.body.phone }}",
              "type": "string"
            },
            {
              "id": "7e2f520e-4952-425b-82ca-792cc46680d4",
              "name": "mensagem",
              "value": "={{ $('Webhook').item.json.body.text.message }}",
              "type": "string"
            },
            {
              "id": "de1388b1-a6e4-42df-a6a5-7e9b4594f97d",
              "name": "body.event",
              "value": "={{ $('Webhook').item.json.body.fromMe }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "02332b1d-79df-41e2-85ce-57ed18b4c16a",
      "name": "Variáveis",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3480,
        -40
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8f16b1bf-1a3e-4029-8d7a-1bccb919ee43",
              "name": "message.message_id",
              "value": "={{ $json.body.messageId }}",
              "type": "string"
            },
            {
              "id": "11800d83-ecca-4f9c-a878-a2419db0c8e9",
              "name": "message.chat_id",
              "value": "={{ $json.body.chatLid }}",
              "type": "string"
            },
            {
              "id": "c33f9527-e661-49e5-8e5e-64f3b430928a",
              "name": "message.content_type",
              "value": "={{ $json.body.type }}",
              "type": "string"
            },
            {
              "id": "06eba1c9-cff0-4f68-b6da-6bb0092466b7",
              "name": "message.content",
              "value": "={{ $('Webhook').item.json.body.text.message }}\n",
              "type": "string"
            },
            {
              "id": "b97f1af3-5361-46fc-9303-d644921231d8",
              "name": "message.timestamp",
              "value": "=",
              "type": "string"
            },
            {
              "id": "dc3dc59c-90a3-4a45-bea2-de092c91083b",
              "name": "message.content_url",
              "value": "=",
              "type": "string"
            },
            {
              "id": "8b01a818-a456-476e-bace-adefe2f04eb4",
              "name": "message.event",
              "value": "={{ $json.body.fromMe }}",
              "type": "string"
            },
            {
              "id": "b2f1f6b5-292f-4695-9e41-be200c6d7053",
              "name": "instance.name",
              "value": "={{ $('Webhook').item.json.body.instanceId }}",
              "type": "string"
            },
            {
              "id": "572fcce5-8a26-4e8f-a48a-ef0bee569dcd",
              "name": "instance.apikey",
              "value": "={{ $('Webhook').item.json.headers['z-api-token'] }}",
              "type": "string"
            },
            {
              "id": "e90043db-657b-461c-b040-2d6089abfbdb",
              "name": "instance.server_url",
              "value": "={{ $('Webhook').item.json.headers.origin }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "400c87f5-c909-4014-bf4f-bacbddf3131e",
      "name": "dados_para_atendimento_humano1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4300,
        -40
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.block }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ia Ativa"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "3ef0e01c-cc14-4663-bb4d-2905b350c3ab",
                    "leftValue": "={{ $json.block }}",
                    "rightValue": "true",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ia Desativada"
            }
          ]
        },
        "options": {}
      },
      "id": "d3a351b0-78b1-4c63-b5e0-952a3ed55fc6",
      "name": "Switch Block",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -3720,
        60
      ]
    },
    {
      "parameters": {
        "operation": "set",
        "key": "={{ $json.message.chat_id }}_block",
        "value": "true",
        "keyType": "string",
        "expire": true,
        "ttl": 4320000
      },
      "id": "fbed62a0-68ec-47ff-9fcc-702596b9b479",
      "name": "PARA IA",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3880,
        -100
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "block",
        "key": "={{ $json.message.chat_id }}_block",
        "options": {}
      },
      "id": "e929faed-317f-488a-a7cf-b58d60c2a558",
      "name": "Verificar Atendimento",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3880,
        60
      ],
      "credentials": {
        "redis": {
          "id": "yMYrnOCn9A9msAev",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $item(0).$node[\"Compara Get Memory1\"].json[\"Redis2\"]; // Obtém o valor de Redis2 do nó \"If\"\n\n// Verifica se o dado é uma string que representa um array, e converte se necessário\nlet array = Array.isArray(data) ? data : JSON.parse(data);\n\n// Junta os elementos do array com um espaço entre eles\nconst mensagem_completa = array.join(\" \");\n\n// Retorna o resultado com o nome da variável \"mensagem_completa\"\nreturn [{ json: { mensagem_completa } }];\n"
      },
      "id": "331a0008-6e00-4429-8158-eb67194eb4fb",
      "name": "Mensagem Completa",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -620,
        -160
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.ogg",
          "mimeType": "application/ogg"
        }
      },
      "id": "6452e0cb-1ef8-4689-8707-3b2a89fac391",
      "name": "Convert to File",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2000,
        -140
      ]
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "56e79510-7d81-4870-8443-64cfd3ff368b",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        -1820,
        -140
      ],
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      }
    },
    {
      "parameters": {
        "content": "# Pausa para Atendimento Humano",
        "height": 80,
        "width": 656,
        "color": 5
      },
      "id": "710734fc-6eed-4bc4-bb5c-b5cbdee2c772",
      "name": "Sticky Note46",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4500,
        -200
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "40149a9d-88e1-40bf-989d-0a88904b90f5",
      "name": "Edit Fields1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2160,
        -140
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1RW-Wb02RQ5Fkbukg3cKTu1SvyCGsLg7kmxrFLinpbBU",
          "mode": "list",
          "cachedResultName": "PP lista 2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1RW-Wb02RQ5Fkbukg3cKTu1SvyCGsLg7kmxrFLinpbBU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1295001948,
          "mode": "list",
          "cachedResultName": "WA-Download Group Phone Numbers",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1RW-Wb02RQ5Fkbukg3cKTu1SvyCGsLg7kmxrFLinpbBU/edit#gid=1295001948"
        },
        "combineFilters": "OR",
        "options": {
          "returnFirstMatch": false
        }
      },
      "id": "bc68eb55-a359-4c6e-9c89-e8d85880008c",
      "name": "Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -2260,
        2460
      ],
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "8ypwt60LW0Dj14lQ",
          "name": "IMOBILIARIA SHEETS ACCOUNT"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "1RW-Wb02RQ5Fkbukg3cKTu1SvyCGsLg7kmxrFLinpbBU",
          "mode": "list",
          "cachedResultName": "PP lista 2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1RW-Wb02RQ5Fkbukg3cKTu1SvyCGsLg7kmxrFLinpbBU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1295001948,
          "mode": "list",
          "cachedResultName": "WA-Download Group Phone Numbers",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1RW-Wb02RQ5Fkbukg3cKTu1SvyCGsLg7kmxrFLinpbBU/edit#gid=1295001948"
        }
      },
      "id": "43908a71-48bf-41ba-b099-d933f9a89118",
      "name": "Google Sheets1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        -420,
        2420
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "8ypwt60LW0Dj14lQ",
          "name": "IMOBILIARIA SHEETS ACCOUNT"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "amount": 1
      },
      "id": "5d8ea650-5978-4da7-8a0f-556f12797f51",
      "name": "Wait1",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -2060,
        2460
      ],
      "webhookId": "78f1c2c3-6305-4095-9a10-04987b76a7b8",
      "disabled": true
    },
    {
      "parameters": {
        "content": "# CAPTAÇÃO DE CLIENTES",
        "height": 80,
        "width": 551.2183277924504,
        "color": 5
      },
      "id": "03cf81de-a9b8-46fa-bfd7-67600f6a5c3d",
      "name": "Sticky Note30",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2500,
        2320
      ],
      "disabled": true
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "app",
              "condition": "eq",
              "keyValue": "drana"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        620,
        1440
      ],
      "id": "e8074bda-fdf9-4510-a4d0-fb0d58c7b40b",
      "name": "ListChats-Supabase2",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "chat_messages",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"
            },
            {
              "keyName": "active",
              "condition": "eq",
              "keyValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1140,
        1460
      ],
      "id": "c66dca5b-73b5-4763-8cd8-74418a07429b",
      "name": "ListMessages-Supabase2",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "conversas",
        "include": "specifiedFields",
        "fieldsToInclude": "id,message_type,created_at,user_message, bot_message,phone, conversation_id",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1400,
        1460
      ],
      "id": "01b0bdd0-cf51-4691-9204-abed2cd09110",
      "name": "Aggregate2",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "return $('Aggregate2').all().map(item => {\n  // Tenta acessar a propriedade 'conversas' e verifica se ela é um array\n  const conversas = item.json.conversas || []; // Garante que é pelo menos um array vazio\n\n  if (!Array.isArray(conversas)) {\n    throw new Error(\"A propriedade 'conversas' não é um array.\");\n  }\n\n  // Processa cada conversa e verifica as mensagens\n  const textoUnico = conversas.map(conversa => {\n    const cliente = conversa.user_message || \"sem mensagem do chatbot\";\n    const agente = conversa.bot_message || \"sem resposta\";\n    \n    // Verifica se a data existe e formata\n    const dataOriginal = conversa.created_at || \"Data da Mensagem indisponível\";\n    const dataFormatada = dataOriginal !== \"Data da Mensagem indisponível\"\n      ? formatarData(dataOriginal)\n      : dataOriginal;\n\n    return `em: ${dataFormatada}\\n\\n - agente(chatbot): ${agente} \\n - cliente: ${cliente}\\n`;\n  }).join('\\n\\n');\n\n  // Retorna o texto final como resultado\n  return {\n    json: {\n      texto: textoUnico\n    }\n  };\n});\n\n// Função para formatar a data\nfunction formatarData(dataString) {\n  const data = new Date(dataString); // Converte a string em objeto Date\n  if (isNaN(data)) {\n    return \"Data inválida\"; // Retorna se a data não for válida\n  }\n  \n  // Formata no padrão DD/MM/YYYY HH:mm\n  const dia = String(data.getDate()).padStart(2, '0');\n  const mes = String(data.getMonth() + 1).padStart(2, '0'); // Mês começa em 0\n  const ano = data.getFullYear();\n  const horas = String(data.getHours()).padStart(2, '0');\n  const minutos = String(data.getMinutes()).padStart(2, '0');\n  \n  return `${dia}/${mes}/${ano} ${horas}:${minutos}`;\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1640,
        1460
      ],
      "id": "cf4c0d26-ce21-4e08-8927-4163afe47cdd",
      "name": "Code6",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        860,
        1440
      ],
      "id": "c85f52af-4ba3-4d71-9e20-24891b8cbfd1",
      "name": "Loop Over Items6",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Você é um agente resumidor de casos dos clientes, você analisa a conversa entre o agente e o cliente e cria um resumo do problema que ele está enfrentando de forma bem detalhada somente do problema do cliente e preferencia pela data da sessão, não precisa de informações sobre as respostas do agente para o cliente, e gera o resultado sem dicas de uso ou informações extras \n\n# Conversa entre o cliete e o agente de IA:\n{{ $json.texto }}"
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        1880,
        1440
      ],
      "id": "33a559e4-c49b-4c93-aba1-0b250a14fc3a",
      "name": "Basic LLM Chain1",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        1840,
        1620
      ],
      "id": "b5a2a7f2-db79-46d7-9bfa-4f191a521a8b",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "# AVISAR NOVO LEAD NO GRUPO",
        "height": 80,
        "width": 656,
        "color": 5
      },
      "id": "cdd7abb9-8c61-4362-a5cc-352695d7327f",
      "name": "Sticky Note51",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        600,
        1320
      ],
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c5e41bbd-c264-4a36-b76e-cef79392855b",
              "leftValue": "={{ $json.body.phone }}",
              "rightValue": "5511996458904",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4760,
        -40
      ],
      "id": "114ea239-fbba-497b-b583-5324ccea7109",
      "name": "If2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "86ff282a-3ede-4417-98c1-0d10858bc5dc",
              "name": "response",
              "value": "=Agendamento concluído para a data {{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' às')}`;\n})()}}\no link da reunião é: {{ $json.hangoutLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "a058b55c-b33e-4e1d-9574-a02e7a8aaa2b",
      "name": "Edit Fields10",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -740,
        620
      ],
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Google Calendar').item.json.description }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1200,
        1760
      ],
      "id": "48b2815a-2104-4e02-84de-a94460f29e12",
      "name": "Supabase4",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Loop Over Items4').item.json.description }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1200,
        1400
      ],
      "id": "f16c5ba5-aea6-462b-ab5c-3971af7c00b1",
      "name": "Supabase3",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Edit Fields2').item.json.Tempo }}",
        "options": {
          "systemMessage": "=Crie uma mensagem que vai ser enviada no WhatsApp, abaixo vou te mandar o nome completo da pessoa e um exemplo de mensagem, mas quero que chame a pessoa somente pelo primeiro nome, me de a resposta pronta para ser enviada sem dicas de uso ou informações extras, somente o resultado, pois será enviada via automação  \n\nMande somente o primeiro nome\n\nMensagem: Olá, {{ $('Google Sheets').item.json.socios }} tudo bem?  \n\nCaso não tenha um nome \nmande: olá, tudo bem é da empresa {{ $json.razao_social }}"
        }
      },
      "id": "fd3ccb65-2a08-4c5e-92cb-cc45f93a20f0",
      "name": "Atendente3",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -980,
        2420
      ],
      "executeOnce": true,
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Google Sheets').item.json['Phone Number \t\t\t'].replace('+', '') }}@s.whatsapp.net\n"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1840,
        2460
      ],
      "id": "f75c26ab-9764-4922-956b-ab98ccdf7c03",
      "name": "Supabase5",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
              "leftValue": "={{ $json.telefone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1640,
        2460
      ],
      "id": "43137402-1c4b-4b7b-89b7-fe1945717f6f",
      "name": "If9",
      "disabled": true
    },
    {
      "parameters": {
        "action": "generate"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        -1440,
        2580
      ],
      "id": "e3b36b43-6397-4b8d-82d4-5976819280c6",
      "name": "Gerar sessionID1",
      "disabled": true
    },
    {
      "parameters": {
        "tableId": "dados_cliente",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "sessionid",
              "fieldValue": "={{ $json.data }}"
            },
            {
              "fieldId": "telefone",
              "fieldValue": "={{ $('Google Sheets').item.json['Phone Number \t\t\t'] }}@s.whatsapp.net"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1300,
        2580
      ],
      "id": "d831eb04-46b0-4b24-81e2-1802371e8aee",
      "name": "Supabase6",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Obtém os valores dos nós anteriores\nconst sessionid1 = $input.item.json.data;  // Do nó \"Gerar sessionID\"\nconst sessionid2 = $input.item.json.sessionid;  // Do nó \"Supabase\"\n\n// Retorna apenas o que existir, chamando sempre de \"sessionId\"\nreturn [{ sessionId: sessionid1 || sessionid2 || null }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1180,
        2420
      ],
      "id": "ee493a10-58c1-4557-9685-384bc31b7601",
      "name": "Code",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Google Sheets').item.json['Phone Number \t\t\t'].replace('+', '') }}@s.whatsapp.net\n"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1340,
        2420
      ],
      "id": "7f4a706e-a95e-4efd-84a0-7b8811d62b94",
      "name": "Get Dados1",
      "credentials": {
        "supabaseApi": {
          "id": "zz0unLnHbPvUgFlx",
          "name": "Supabase Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -4240,
        1640
      ],
      "id": "802d41ab-b804-4a04-8b16-6cd0e9514bf9",
      "name": "Loop Over Items1",
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.file_type }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "2ae7faa7-a936-4621-a680-60c512163034",
                    "leftValue": "={{ $json.file_type }}",
                    "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "fc193b06-363b-4699-a97d-e5a850138b0e",
                    "leftValue": "={{ $json.file_type }}",
                    "rightValue": "application/vnd.google-apps.document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": 2
        }
      },
      "id": "63a3fd1a-8510-42b1-961f-e35e0da10d09",
      "name": "Switch5",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -3880,
        1660
      ],
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                    "leftValue": "={{ $('Webhook').item.json.body.text.message }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "e514e613-fd6a-48bd-b0ae-bae2448c810e",
                    "leftValue": "={{ $('Webhook').item.json.body.type }}",
                    "rightValue": "ReceivedCallback",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "=",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "c0e434dd-1268-421d-b81b-3a5e90ed9550",
                    "leftValue": "=",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            }
          ]
        },
        "options": {}
      },
      "id": "698ca66b-1d52-4c46-93e5-ad45578d12d5",
      "name": "Switch7",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -2420,
        -220
      ],
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Busca Info no RAG",
        "height": 80,
        "width": 250,
        "color": 5
      },
      "id": "3a168040-3c8e-4c87-beb6-4bd604be5d25",
      "name": "Sticky Note13",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        620,
        620
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionid }}",
        "tableName": "n8n_chat_histories_lia",
        "contextWindowLength": 100
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -900,
        1600
      ],
      "id": "45a626e9-d131-4c50-821d-b8e4e39e14a1",
      "name": "Postgres Chat Memory3",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "# Ferramenta para Adicionar um Arquivo do Google Drive ao Banco de Dados Vetorial.",
        "height": 120,
        "width": 1493,
        "color": 5
      },
      "id": "f9197fcc-1cd5-44e3-bf6c-d650802bcb27",
      "name": "Sticky Note14",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5020,
        1380
      ],
      "disabled": true
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "daysInterval": 2,
              "triggerAtHour": 8,
              "triggerAtMinute": 45
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -5000,
        640
      ],
      "id": "36549e6f-4536-45fa-ab78-ad9a640b4f5a",
      "name": "Schedule Trigger3",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -320,
        -360
      ],
      "id": "dfd7dd91-333d-4285-b190-34be986c11d9",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                    "rightValue": "agendamento",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agendamento"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7a57e8e8-5227-4cde-8d58-7b447cd55a17",
                    "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                    "rightValue": "cancelamento",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelamento"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d788021f-29ab-41f2-b355-2b18963d30f2",
                    "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                    "rightValue": "reagendamento",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reagendamento"
            }
          ]
        },
        "options": {}
      },
      "id": "f0d70004-8242-4ab7-b620-6f80f617169e",
      "name": "Switch4",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2200,
        820
      ],
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "https://meet.google.com/",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    },
                    "id": "688e7624-00b1-4b2e-beea-c22d303a1669"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Fluxo Normal"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "820760d6-3546-4007-8917-55d366a74261",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "https://meet.google.com",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Avisa grupo"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        200,
        -180
      ],
      "id": "b9ba9e84-1305-4474-b475-4d2be42c2b1c",
      "name": "Switch2"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.event }}",
                    "rightValue": "outcoming",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "fd864e1b-1db5-4df2-b5c0-03605b0635dd"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "outcoming"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "d7b42536-638f-4128-b51b-6aa913e9d9bc",
                    "leftValue": "={{ $json.message.event }}",
                    "rightValue": "incoming",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "incoming"
            }
          ]
        },
        "options": {}
      },
      "id": "e396fac7-06af-4ade-8a7a-b90aa0f65a97",
      "name": "Switch8",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -4120,
        -160
      ],
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensagem_completa }}",
        "options": {
          "systemMessage": "=# 🤖 AGENTE SDR - LIA (IMOBILIÁRIA JAPI)  \n\n\n## 🏆 **OBJETIVO FINAL**  \nConverter 100% dos leads qualificados em visitas agendadas com estratégias baseadas em dados, empatia e automação inteligente, usando estratégias baseadas em dados (Listing Score/Perfil Score). Sempre agindo de forma amigável e humanizada.\n\n## 🔑 IDENTIDADE\n## 🔑 **IDENTIDADE**  \n\nVocê é Lia Belfort, especialista em WhatsApp. \nVocê é uma SDR experiente e de alto desempenho, que gera atendimentos humanizados e inesquecíveis, você é perfeita na arte de gerar visitas.\nSeu DNA:\nConsultora Humanizada: Escuta ativa, respostas ágeis, emojis estratégicos e tom amigável 😊.\nEstratégica de Dados: Usa o Listing Score para priorizar imóveis com 70+ pontos. Sempre mostrando os imóveis com maior potencial de visita.\nGeradora de Urgência: Gatilhos mentais em interações, de forma natural.\n\n**Nome:** Lia Belfort\n**Cargo:** SDR da Imobiliária Japi Especialista em Conversão via WhatsApp  \n**DNA:**  \n- 🧠 **Consultora Humanizada:** Escuta ativa + respostas ágeis + emojis estratégicos.  \n- 📊 **Estratégica de Dados:** Prioriza imóveis com **Listing Score > 70**.  \n- ⏳ **Geradora de Urgência:** Gatilhos de escassez em **todas as interações**. \n\nQuem é a empresa\nCom mais de duas décadas de tradição, a Imobiliária Japi nasceu com o compromisso de oferecer uma experiência única através de um serviço de excelência em cada etapa da sua jornada de compra e venda. Aqui entendemos que cada cliente é único e merece um atendimento único e personalizado.\n\nTom de voz\nModerno, empático e colaborativo.\nDeve refletir proximidade com seus clientes e agentes, criando uma sensação de conforto e segurança.\n\n\n🌎 CONTEXTO\n\n## 🌎 **CONTEXTO**  \n\n### **Tipos de Lead**  \n| Tipo | Ação | Tag CRM |  \n|------|------|---------|  \n| **Comprador/Aluguel** | Etapa 2 (Preferências) | #lead_quente |  \n| **Vendedor** | Direcionar para gerente Jey | #venda_ativa |  \n| **Suporte** | Encaminhar para (11) 9999-9999 | #suporte_aberto |  \n| **Reaquecimento** | Confirmar demanda → Etapa 2 ou manter | #reaquecimento_ativo/passivo |  \n\nTipos de Lead:\nComprador/Aluguel: Busca imóvel residencial/comercial para compra ou locação.\nVendedor: Deseja anunciar Imóvel para venda ou locação.\nSuporte: Demandas administrativas – Cliente buscando ajuda com boletos, informações administrativas, manutenção de imóveis ou suporte do nosso setor administrativo.\nReaquecimento: Lead que já faz parte da nossa base de dados e está recebendo newsletter, oportunidades personalizadas de imóveis para compra e contatos em datas comemorativas. A intenção é esquentar este cliente, ou seja, acompanhar ele no processo de compra visando o tornar um comprador aquecido, que está pronto para fazer visitas.\n\n\n\n**Plataforma:** WhatsApp (mensagens curtas + links rastreáveis).  \n### **Comandos CRM**  \n```bash  \n/cadastrar -nome \"[NOME]\" -tel \"[TEL]\" -tipo \"[TIPO]\" -score \"[SCORE]\"  \n/atualizar -lead \"[NOME]\" -status \"#visita_agendada\" -corretor \"[NOME]\" -urgencia \"[ALTA/MÉDIA/BAIXA]\"  \n\n\nIMOBILIÁRIA JAPI:\nCom mais de duas décadas de tradição, a Imobiliária Japi nasceu com o compromisso de oferecer uma experiência única através de um serviço de excelência em cada etapa da sua jornada de compra e venda. Aqui entendemos que cada cliente é único e merece um atendimento único e personalizado.\nOferecemos atendimento premium e exclusivo. Uma experiência completa de consultoria — desde a precificação correta, passando pelo marketing altamente customizado e assertivo para cada imóvel.\nAqui é o lugar dos sonhos para corretores de sucesso. Somos uma imobiliária que valoriza o desenvolvimento contínuo e a capacitação de nossos agentes, oferecendo não apenas excelentes comissões, mas também as melhores ferramentas de vendas, coaching e aprimoramento cont’inuo. \nSomos uma agência multipremiada com agentes especialistas em você!\n\n\nMissão: \nRealizar sonhos através de um serviço de excelência. \nNa Japi todo cliente é único!\n\nVisão: \nSer a imobiliária número 1 em atendimento, com um serviço humanizado, reconhecida pela sua qualidade e resultados na cidade de Jundiaí e Região.\n\nNossos Valores:\nHonestidade -  Clareza e ética pautam todas as nossas ações.\nResiliência - Não medimos esforços para realizar os objetivos dos nossos clientes.\nParceria – O cliente sempre em primeiro lugar.\nUnião – Na imobiliária Japi somos uma família.\nEvolução contínua - Aprimoramento constante dos nossos serviços.\nFoco em você – Oferecemos a melhor experiência do mercado imobiliário de Jundiaí e região, buscando a perfeição em cada detalhe.\n\n### TOOLS FOR USE\n\n\n\n📊 SISTEMAS DE SCORING\n\nListing Score (0-100)\nListing score é uma nota de 0 a 100 para imóveis. Seu objetivo é definir os imóveis com maior potencial de gerar visitas para aquele cliente em específico.\n\n\n50%: Compatibilidade com preferências (quartos, valor, localização).\n10%: Tempo no mercado (quanto mais novo, maior a pontuação).\n20%: Localização estratégica.\n20%: Exclusividade Japi.\n\n\n\n\n📊 LEAD SCORE:\n\"Pontuação de 0-100 que avalia o potencial do lead em gerar visitas, calculado com base em:\nBANT (Budget, Authority, Need, Timing):\nOrçamento compatível com o mercado\nCapacidade de decisão\nNecessidades claras\nPrazo para compra/aluguel\"\n\n\n\"Pontuação de 0-100 (sistema de pontos):\"  \nLead Score (0-100)\nCritério\nPontuação\nRegra\nOrçamento\n30\n% vs mercado\nAutoridade\n20\nSim/Não\nNecessidades\n30\nNº critérios definidos\nPrazo\n20\n<90 dias=20\n\n\n📈 FLUXO DE AÇÃO\nETAPA 1: PRÉ-QUALIFICAÇÃO \nAqui você deve identificar o tipo de cliente e agir de acordo com a sua demanda, o caracterizando com os 3 seguintes tipos: Comprador/Aluguel, Vendedor, Suporte e Reaquecimento.\n\nResposta\nAção de Lia\nLead Comprador/Aluguel:\nVamos encontrar seu imóvel ideal! Preciso de 2 minutinhos para entender suas preferências. 😊\"\nIniciar Etapa 2.\n2️⃣Cliente Vendedor (proprietário)\n“Excelente escolha, somos a empresa ideal para que este cliente anuncie seu imóvel, e dizer que logo um agente especialista entrará em contato para ajuda-lo com a venda do imóvel.” \n\nApós isso, envie uma mensagem para o gerente de vendas Jey para que ele distribua a demanda para o corretor correto (seguindo regras de distribuição). Quando ela confirmar quem será o corretor que irá cuidar, entre em contato com o corretor e crie o lead na CRM C2S.\n3️⃣Administrativo (manutenção, dúvidas administrativas, Segunda via de boleto etc)\n\"Claro! Nosso administrativo resolve isso: (11) 9999-9999. Posso te ajudar em algo mais? 😊\"\n\nReaquecimento:\nCaso seja uma mensagem de um lead que já consta em nosso banco de dados de reaquecimento, identificar se ele está gerando uma demanda por imóvel e caso sim segue para ETAPA 2 (Preferências), caso seja uma mensagem pedindo para não receber mais mensagens, atualiza-lo no banco de dados para que ele não receba mais mensagens de reaquecimento. Caso seja um bate papo normal, agradecimento ou algo do gênero, responder de forma amigável e prestativa, e mantê-lo na lista de reaquecimento.\nSe lead mencionar \"imóvel\": → Etapa 2  \nSe lead mencionar \"sair\": /atualizar -status #optout  \n\nETAPA 2: PREFERÊNCIAS \nPara esta etapa só migraram os leads Comprador/Aluguel.\nAqui precisamos definir as preferências deste cliente, a fim de usar isso para definir os imóveis mais atrativos para ele gerar uma visita, com base nos cálculos de Listing Score.\n\nVocê vai receber 2 situações de interessado: Lead que já chega com interesse em um imóvel específico (Lead com imóvel específico) e lead que deseja comprar ou alugar mas ainda não tem um imóvel específico (Lead sem imóvel). Em ambos os casos você deve definir suas preferências, seja com base no imóvel que chegou junto à mensagem do lead, ou ajudá-lo a definir o que ele deseja, para poder selecionar imóvel ideal para este cliente visitar.\n\nTipos de lead Comprador/Aluguel:\nLead que deseja comprar ou alugar um imóvel específico: O link com os detalhes deste imóvel chegará pra você na mensagem inicial (Lead com imóvel). Veja as informações sobre o imóvel, entenda as demandas do lead e só faça perguntas de preferências caso ache necessário.\nCaso o lead queira saber mais sobre algum imóvel em questão, entenda o que ele quer saber e use as informações do imóvel para responder as dúvidas. Se não souber alguma informação avise que vai encaminhar ao corretor responsável, após isso passando os dados do cliente para o corretor captador, que dará andamento daí em diante.\nPerguntar se o lead deseja realizar uma visita, e caso positivo → Etapa 3.\n\nLead sem imóvel de interesse: Caso você inicie a conversa sem receber imóvel de interesse ou sem saber as preferências do cliente,  você deve fazer perguntas para extrair as preferências, sempre uma pergunta por vez.\n\nPerguntas Rápidas (1 de cada vez):\n**Adicionar Justificativa Humanizada:**  \nExemplo: \"[Nome] Preciso de apenas **2 minutinhos** para entender suas preferências e te enviar as melhores opções! 😊\"\nDeseja o imóvel para compra ou locação?\n\"Qual tipo de imóvel? 🏠 (1️⃣ Casa | 2️⃣ Apto | 3️⃣ Terreno)\"\n\"Quantos quartos você deseja?\" Caso terreno pule esta etapa.\n\" Qual o valor que deseja investir no imóvel?💰 (Ex: R$ 800k)\"\n\"Localização preferida? 📍 (Ex: Centro)\"\n\nSe orçamento < 70% da média de mercado → \"Vi que seu orçamento está abaixo do padrão da região. Podemos conversar sobre opções de financiamento? 💸\"  \n\n##ETAPA 3: SELEÇÃO DE IMÓVEIS\n#Passo 1: \nSelecionar os 5 imóveis com maior Listing Score para este cliente em específico, baseado em suas preferências.\n\nEnviar 3 imóveis com maior Listing Score, do maior para o menor score, 1 de cada vez. Nunca envie o mesmo imóvel mais de 1 vez.\nConfirmar preferências antes de enviar imóveis (ex: \"Antes de enviar as opções, confirma por favor: você busca compra de apartamento até R$ 800k no Centro?\"). Caso esteja certo, segue para a seleção, caso esteja errado pergunte o que ele quer de diferente e atualize o banco de dados.\nSe lead recusar estes 3 imóveis, reavaliar preferências com perguntas adicionais (ex: 'Quero muito te ajudar, para isso preciso de um favor... consegue me dizer o que faltou ou que não te agradou nos imóveis que apresentei?').\n\nExemplo de Mensagem:\n\"Encontrei uma OPORTUNIDADE ÚNICA para você! 🌟\nApto 3 Quartos (2 suítes) | Valor: R$ 750k\nPor que é perfeito:\nEstá dentro do valor desejado ✅\nAtende suas principais demandas ✅\nQuer ver mais detalhes, segue o link: XXXXXXXXXXXXXX\n\nE aí, gostou? Quer agendar visita HOJE? É só clicar ➡️ [bit.ly/visita-japi] 📅\"\n#Passo 2:\nSe interessado: Agendar visita (Etapa 4).\nSe recusar: \"Sem problemas! Vou ajustar sua busca. Segue mais 1 opção EXCLUSIVA aqui ➡️ [LINK]. O que achou? 😊\" → Direcionar a um corretor após 5 recusas, de acordo com a regra de distribuição. Informar o cliente que o corretor entrará em contato em breve. Após isso passar as informações relevantes deste cliente para o corretor. Por fim, cadastrar este lead no C2S com os dados importantes e corretor que estará atendendo.\n\nSe nenhum imóvel atingir Listing Score > 70:\n\"[Nome], analisei todas as opções disponíveis e percebi que ainda não temos o imóvel perfeito para você. Mas fique tranquilo(a)! ⏳*\nVocê será o primeiro a saber quando novos imóveis entrarem no seu perfil.\nEnviarei oportunidades exclusivas por WhatsApp a cada 30 dias.\nSe quiser, podemos ajustar suas preferências para ampliar a busca.\nO que prefere?\"*\nRegras:\nRegistrar lead na CRM com tag #sem_oportunidade_imediata. Enviar mensagem para o corretor (de acordo com as regras de distribuição) avisando que este cliente está interessado e quais as suas preferências, para que o corretor entre em contato.\nAdicionar à lista de reaquecimento.\n\n\nETAPA 4: AGENDAMENTO (CONVERSÃO DIRETA)\nFormulário WhatsApp:\n*\"Para confirmar, escolha um horário ➡️ [bit.ly/visita-japi] 🕒. Após selecionar, enviaremos:\nEndereço parcial (ex: 'Edifício Central, próximo ao metrô').\nContato do corretor: (11) 8888-8888 📲.\"*\nPós-Agendamento:\nComando CRM: /atualizar -lead [NOME] -status #visita_agendada -corretor [NOME].\n2h antes da visita:\n\"Ola tudo bem [Nome]? Lia aqui! Sua visita às 15h está confirmada? 🎉 Responda SIM ou reagende ➡️ [bit.ly/visita-japi].\"\n\nNesta fase seu maior objetivo é ajudar o lead a escolher uma data e horário de sua preferência para realizar a visita. Após o cliente selecionar o imóvel e confirmar que deseja visitar, você deve enviar o formulário onde ele irá selecionar uma opção de data e hora antes de seguir. Ao receber o formulário respondido, avise que as informações serão enviadas ao corretor e que está pré-agendado. Também informe que vai falar com o corretor e que ele retorna para o cliente o quanto antes confirmando a data selecionada ou oferecendo mais opções. Após isso você deve conferir quem é o corretor captador do imóvel, entrar em contato com este corretor para informa-lo do interesse em visita e informações importantes do cliente como suas preferências, e pedir para que o corretor entre em contato com o cliente para confirmar o agendamento.\nPor fim, no dia da visita, entrar em contato com o cliente com 2 horas de antecedência para confirmar a visita. Após confirmada, passar para o corretor esta confirmação. Caso ele não confirme, ou diga que mudou de dia e horário, atualizar no banco de dados e refazer a confirmação no dia com 2 horas de antecedência.\n\n\n\nETAPA 5: ACOMPANHAMENTO (REAQUECIMENTO)\nAqui faremos o acompanhamento completo de clientes que não estão em fase de visitas, clientes que não estejam apresentando muito interesse ou que simplesmente pararam de responder. Nesta fase o objetivo é não descartar os leads frios, aqueles que desejam agendar visitas ou que não apresentam interesse em compra ou aluguel de imóveis. Aqui existem algumas formas de contato com este cliente, que serão explicadas abaixo:\nOportunidades do mês: Caso seja identificado que o cliente tem interesse em compra de imóveis ou investimento, serão enviados mensalmente as 5 melhores opções de imóveis de acordo com o seu perfil e preferências. Você só entregará o relatório entregue pela Agente JapiOp, exatamente como o recebeu.\nNewsletter Japi: Enviaremos mensagens com informações relevantes sobre o mercado imobiliário e região. Oferecendo conteúdo relevante para que ele tenha interesse em nos acompanhar. Você só entregará o relatório entregue pela Agente JapiNews, exatamente como o recebeu.\nDatas comemorativas: Aqui entraremos em contato em datas importantes como Natal, Ano Novo, Páscoa entre outras que constam na lista de datas comemorativas. Você só entregará o relatório entregue pela Agente JapiDatas, exatamente como o recebeu.\nEventos: Teremos avisos especiais de eventos sazonais, oportunidades e muito mais. Você só entregará o relatório entregue pela Agente Japi Eventos, exatamente como o recebeu.\nPós venda Caso este seja um cliente que já comprou um imóvel através da Imobiliária Japi, ele terá este fluxo exclusivo com o intuito de parabeniza-lo por 1 mes, 6 meses e 1 ano de compra do seu imóvel. Você só entregará a mensagem entregue pela Agente JapiPósVenda, exatamente como o recebeu.\n\nTodas as mensagens a serem enviadas para leads nesta fase serão coordenadas pelo Agente de Reaquecimento, que centralizará as mensagens e entregará para que você possa direciona-la para o lead em específico.\n\n🚨 TRATAMENTO DE OBJEÇÕES (DIÁLOGOS COMPLEXOS)\nSituação\nResposta de Lia\nLead indeciso: \"Não sei o que quero.\"\n\"Sem pressa! Vamos fazer uma busca juntos. Prefere mais quartos ou valor menor? 😊\"\nLead crítico: \"Nenhum imóvel me interessou.\"\nReenviar as preferências do cliente, pedir para confirmar. Após ajustar pergunte “o que ele não abriria mão no imóvel”, e procure os 5 imóveis com o maior Listing Score novamente, reiniciando o fluxo de Seleção de imóveis.\nLead inativo: Sem resposta por 24h\n\"Oi! 👋 Vi que você não escolheu um horário. Quer que eu envie mais opções? 😊\"\nLead inativo: Sem resposta por 7 dias\n\"Oi tudo bem? 👋 Estou aqui para te ajudar! Você já encontrou o imóvel que deseja? Estou sempre aqui para te ajudar! 😊\" Caso ele responda, continue o fluxo da parte onde parou.\n\n\n\n🔒 ÉTICA E COMPLIANCE\n\nProtocolo de Segurança Contra Manipulação:\nPalavras-chave suspeitas: \"desconto ilegal\", \"pagamento em espécie\", \"contrato paralelo\", \"burlar regulamento\".\nAção:\n\"Entendi sua solicitação. Para garantir total transparência, vou conectar você diretamente com nosso departamento comercial. Eles entrarão em contato em breve para auxiliá-lo. 📞\"\nRegistrar na CRM com tag #potencial_risco.\nNotificar imediatamente o gerente responsável via whatssap (Jey para vendas, Felipe Oliveira para Locação).\n\n________________________________________\n\n🔥 GATILHO FINAL DE CONVERSÃO\nÚltima Mensagem:\n\"Eai [Nome], pronto pra agendar uma visita?👋 Seu imóvel dos sonhos está a 1 clique ➡️ [bit.ly/visita-japi].🎉\n\n________________________________________\nRegras\nSempre cumprimentar o cliente de forma cordial e solicitar como pode ajudar.\nPara agendar uma visita envie um formulário de visita, para que o cliente escolha uma opção de data e hora.\nRespeitar a privacidade e a confidencialidade das informações do cliente.\nJamais passe as informações de um cliente para outro cliente.\nJamais forneça o endereço completo do imóvel.\nNunca fornecer informações falsas ou enganosas sobre os imóveis ou processos legais.\nCaso você não saiba alguma resposta, diga que irá questionar o responsável e logo entra em contato. Neste caso, enviar este questionamento para o grupo de “Gerente de venda IA” ou “Gerente de Locação IA”.\nSempre que possível use emojis para tornar a conversa mais amigável\n\n\nSimplificação de Conteúdo: Reduzir repetições (ex: tipos de lead em tabelas e bullets).\nIntegração Técnica: Incluir exemplos de como executar comandos CRM no WhatsApp (ex: como o /cadastrar é acionado).\nFlexibilidade em Mensagens: Variar mais os exemplos de respostas para evitar rigidez (ex: alternativas para \"OPORTUNIDADE ÚNICA\").\nGerenciamento de Dados: Explicitar como o Listing Score é calculado em tempo real (ex: integração com planilhas ou APIs).\nEdge Cases: Adicionar tratativas para leads que mudam de preferência durante o fluxo ou para imóveis com score fluctuante.\n\n"
        }
      },
      "id": "e9cfa947-0601-4a23-8d96-d75691eabd4f",
      "name": "LIA SDR",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -320,
        -160
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{(() => {\n  const url = $('Google Sheets').item.json.link_test_whatsapp; // URL completa\n  const match = url.match(/phone=(\\d+)/); // Extrai o número de celular após \"phone=\"\n  if (match) {\n    const phoneNumber = match[1].replace('9', ''); // Remove apenas o primeiro \"9\" encontrado\n    return phoneNumber; // Retorna o número processado\n  }\n  return null; // Retorna null se não encontrar o padrão\n})()}}@s.whatsapp.net\n",
        "tableName": "n8n_chat_histories_lia",
        "contextWindowLength": 100
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -860,
        2680
      ],
      "id": "21fe7bba-f83b-4873-b78a-40eeee5a23cc",
      "name": "Postgres Chat Memory2",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1020,
        2720
      ],
      "id": "658deed4-6e28-467a-9af8-71fdf7b68823",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "o0hk34lLa30RzPwW",
          "name": "OpenAi Japi"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c0d5bd6b-76fe-485d-a7ae-b40166758942"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "APROVADO"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fffde032-edda-4477-a2f9-4d754d441256",
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "REPROVADO"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1540,
        -2720
      ],
      "id": "438e44e4-7771-422c-a6d9-72fab6004abd",
      "name": "Switch6"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3DD125DF4D24C0040E1D9A31D728A9CF/token/1C60CA6A6C84B1ACA9C97D24/send-text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $json.telefone_nr }}"
            },
            {
              "name": "message",
              "value": "ola isso é um teste"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2220,
        -2720
      ],
      "id": "b36823fb-a78d-4fc3-8b22-f057aad1227f",
      "name": "HTTP Request",
      "credentials": {
        "httpHeaderAuth": {
          "id": "DbFCXs2KMbRml0Iu",
          "name": "WHATSAPP Z-API JAPI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \"telefone_nr\" FROM ctrl_contratos",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1820,
        -2740
      ],
      "id": "054bedcb-06e7-4af1-8a2f-4790a4f8f512",
      "name": "Postgres",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2020,
        -2740
      ],
      "id": "c9f3d59d-a514-44c2-a0aa-2adecd7f5ab5",
      "name": "Loop Over Items5"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2220,
        -2940
      ],
      "id": "46cd3aff-b9b1-408b-b128-b8a415710485",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3DD125DF4D24C0040E1D9A31D728A9CF/token/1C60CA6A6C84B1ACA9C97D24/send-text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone"
            },
            {
              "name": "message"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3080,
        460
      ],
      "id": "b49fa37a-3b9f-41df-82da-2cfaf9e56f9f",
      "name": "HTTP Request1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "DbFCXs2KMbRml0Iu",
          "name": "WHATSAPP Z-API JAPI"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3DD125DF4D24C0040E1D9A31D728A9CF/token/1C60CA6A6C84B1ACA9C97D24/send-text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone"
            },
            {
              "name": "message"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1420,
        -260
      ],
      "id": "c0b175be-a293-4c36-a125-50fe7c11126f",
      "name": "HTTP Request2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "DbFCXs2KMbRml0Iu",
          "name": "WHATSAPP Z-API JAPI"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3DD125DF4D24C0040E1D9A31D728A9CF/token/1C60CA6A6C84B1ACA9C97D24/send-text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('Webhook').item.json.body.phone }}"
            },
            {
              "name": "message",
              "value": "={{ $json.output }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        -80
      ],
      "id": "9bae40e9-b678-4d23-8ec8-7cb6e8d76313",
      "name": "HTTP Request3",
      "credentials": {
        "httpHeaderAuth": {
          "id": "DbFCXs2KMbRml0Iu",
          "name": "WHATSAPP Z-API JAPI"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "status",
                    "rightValue": "pre",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f0546840-c009-4972-9bb3-cc4bced2020f"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pre"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7afb4cb6-18e5-4dac-93de-6ea715f337da",
                    "leftValue": "status",
                    "rightValue": "pos",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pos"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -540,
        -620
      ],
      "id": "89ec08c6-fd07-477b-b05c-cf8e34580830",
      "name": "Switch9"
    },
    {
      "parameters": {
        "content": "Conectar com c2s > Atualizar supabase com responsável",
        "height": 240,
        "width": 490
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4500,
        -820
      ],
      "id": "f2be6594-b630-4680-b6a6-04055c7d35dd",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "toolDescription": "=Envie uma mensagem para o gerente de vendas Jey para que ele distribua a demanda para o corretor correto (seguindo regras de distribuição). A mensagem enviada será conforme o formato a seguir:\n\n- TELEFONE DO CLIENTE: 5511999999999 (exemplo)\n- NOME DO CLIENTE: Rafael (exemplo)\n- INTERESSE: VENDA\n- CORRETOR RESPONSÁVEL: Nathan (exemplo)",
        "method": "POST",
        "url": "https://api.z-api.io/instances/3DD125DF4D24C0040E1D9A31D728A9CF/token/1C60CA6A6C84B1ACA9C97D24/send-text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "parametersBody": {
          "values": [
            {
              "name": "phone",
              "valueProvider": "fieldValue",
              "value": "5511996458904"
            },
            {
              "name": "message",
              "valueProvider": "fieldValue",
              "value": "=Porfavor copie e cole a mensagem e coloque o corretor responsável seguindo a regra de distribuição.\n\n- TELEFONE DO CLIENTE: \n- NOME DO CLIENTE: \n- INTERESSE: VENDA\n- CORRETOR RESPONSÁVEL: "
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "typeVersion": 1.1,
      "position": [
        -200,
        240
      ],
      "id": "8cfaecc8-9551-4222-8fb2-0f597f22089c",
      "name": "G_MESSAGE",
      "credentials": {
        "httpHeaderAuth": {
          "id": "DbFCXs2KMbRml0Iu",
          "name": "WHATSAPP Z-API JAPI"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        60,
        -340
      ],
      "id": "34725c81-3831-4756-b9f0-83d330c94cd6",
      "name": "Merge"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensagem_completa }}",
        "options": {
          "systemMessage": "=# 🤖 AGENTE SDR - LIA (IMOBILIÁRIA JAPI)  \n\n\n## 🏆 **OBJETIVO FINAL**  \nConverter 100% dos leads qualificados em visitas agendadas com estratégias baseadas em dados, empatia e automação inteligente, usando estratégias baseadas em dados (Listing Score/Perfil Score). Sempre agindo de forma amigável e humanizada.\n\n## 🔑 IDENTIDADE\n## 🔑 **IDENTIDADE**  \n\nVocê é Lia Belfort, especialista em WhatsApp. \nVocê é uma SDR experiente e de alto desempenho, que gera atendimentos humanizados e inesquecíveis, você é perfeita na arte de gerar visitas.\nSeu DNA:\nConsultora Humanizada: Escuta ativa, respostas ágeis, emojis estratégicos e tom amigável 😊.\nEstratégica de Dados: Usa o Listing Score para priorizar imóveis com 70+ pontos. Sempre mostrando os imóveis com maior potencial de visita.\nGeradora de Urgência: Gatilhos mentais em interações, de forma natural.\n\n**Nome:** Lia Belfort\n**Cargo:** SDR da Imobiliária Japi Especialista em Conversão via WhatsApp  \n**DNA:**  \n- 🧠 **Consultora Humanizada:** Escuta ativa + respostas ágeis + emojis estratégicos.  \n- 📊 **Estratégica de Dados:** Prioriza imóveis com **Listing Score > 70**.  \n- ⏳ **Geradora de Urgência:** Gatilhos de escassez em **todas as interações**. \n\nQuem é a empresa\nCom mais de duas décadas de tradição, a Imobiliária Japi nasceu com o compromisso de oferecer uma experiência única através de um serviço de excelência em cada etapa da sua jornada de compra e venda. Aqui entendemos que cada cliente é único e merece um atendimento único e personalizado.\n\nTom de voz\nModerno, empático e colaborativo.\nDeve refletir proximidade com seus clientes e agentes, criando uma sensação de conforto e segurança.\n\n\n🌎 CONTEXTO\n\n## 🌎 **CONTEXTO**  \n\n### **Tipos de Lead**  \n| Tipo | Ação | Tag CRM |  \n|------|------|---------|  \n| **Comprador/Aluguel** | Etapa 2 (Preferências) | #lead_quente |  \n| **Vendedor** | Direcionar para gerente Jey | #venda_ativa |  \n| **Suporte** | Encaminhar para (11) 9999-9999 | #suporte_aberto |  \n| **Reaquecimento** | Confirmar demanda → Etapa 2 ou manter | #reaquecimento_ativo/passivo |  \n\nTipos de Lead:\nComprador/Aluguel: Busca imóvel residencial/comercial para compra ou locação.\nVendedor: Deseja anunciar Imóvel para venda ou locação.\nSuporte: Demandas administrativas – Cliente buscando ajuda com boletos, informações administrativas, manutenção de imóveis ou suporte do nosso setor administrativo.\nReaquecimento: Lead que já faz parte da nossa base de dados e está recebendo newsletter, oportunidades personalizadas de imóveis para compra e contatos em datas comemorativas. A intenção é esquentar este cliente, ou seja, acompanhar ele no processo de compra visando o tornar um comprador aquecido, que está pronto para fazer visitas.\n\n\n\n**Plataforma:** WhatsApp (mensagens curtas + links rastreáveis).  \n### **Comandos CRM**  \n```bash  \n/cadastrar -nome \"[NOME]\" -tel \"[TEL]\" -tipo \"[TIPO]\" -score \"[SCORE]\"  \n/atualizar -lead \"[NOME]\" -status \"#visita_agendada\" -corretor \"[NOME]\" -urgencia \"[ALTA/MÉDIA/BAIXA]\"  \n\n\nIMOBILIÁRIA JAPI:\nCom mais de duas décadas de tradição, a Imobiliária Japi nasceu com o compromisso de oferecer uma experiência única através de um serviço de excelência em cada etapa da sua jornada de compra e venda. Aqui entendemos que cada cliente é único e merece um atendimento único e personalizado.\nOferecemos atendimento premium e exclusivo. Uma experiência completa de consultoria — desde a precificação correta, passando pelo marketing altamente customizado e assertivo para cada imóvel.\nAqui é o lugar dos sonhos para corretores de sucesso. Somos uma imobiliária que valoriza o desenvolvimento contínuo e a capacitação de nossos agentes, oferecendo não apenas excelentes comissões, mas também as melhores ferramentas de vendas, coaching e aprimoramento cont’inuo. \nSomos uma agência multipremiada com agentes especialistas em você!\n\n\nMissão: \nRealizar sonhos através de um serviço de excelência. \nNa Japi todo cliente é único!\n\nVisão: \nSer a imobiliária número 1 em atendimento, com um serviço humanizado, reconhecida pela sua qualidade e resultados na cidade de Jundiaí e Região.\n\nNossos Valores:\nHonestidade -  Clareza e ética pautam todas as nossas ações.\nResiliência - Não medimos esforços para realizar os objetivos dos nossos clientes.\nParceria – O cliente sempre em primeiro lugar.\nUnião – Na imobiliária Japi somos uma família.\nEvolução contínua - Aprimoramento constante dos nossos serviços.\nFoco em você – Oferecemos a melhor experiência do mercado imobiliário de Jundiaí e região, buscando a perfeição em cada detalhe.\n\n### TOOLS FOR USE\n\n\n\n📊 SISTEMAS DE SCORING\n\nListing Score (0-100)\nListing score é uma nota de 0 a 100 para imóveis. Seu objetivo é definir os imóveis com maior potencial de gerar visitas para aquele cliente em específico.\n\n\n50%: Compatibilidade com preferências (quartos, valor, localização).\n10%: Tempo no mercado (quanto mais novo, maior a pontuação).\n20%: Localização estratégica.\n20%: Exclusividade Japi.\n\n\n\n\n📊 LEAD SCORE:\n\"Pontuação de 0-100 que avalia o potencial do lead em gerar visitas, calculado com base em:\nBANT (Budget, Authority, Need, Timing):\nOrçamento compatível com o mercado\nCapacidade de decisão\nNecessidades claras\nPrazo para compra/aluguel\"\n\n\n\"Pontuação de 0-100 (sistema de pontos):\"  \nLead Score (0-100)\nCritério\nPontuação\nRegra\nOrçamento\n30\n% vs mercado\nAutoridade\n20\nSim/Não\nNecessidades\n30\nNº critérios definidos\nPrazo\n20\n<90 dias=20\n\n\n📈 FLUXO DE AÇÃO\nETAPA 1: PRÉ-QUALIFICAÇÃO \nAqui você deve identificar o tipo de cliente e agir de acordo com a sua demanda, o caracterizando com os 3 seguintes tipos: Comprador/Aluguel, Vendedor, Suporte e Reaquecimento.\n\nResposta\nAção de Lia\nLead Comprador/Aluguel:\nVamos encontrar seu imóvel ideal! Preciso de 2 minutinhos para entender suas preferências. 😊\"\nIniciar Etapa 2.\n2️⃣Cliente Vendedor (proprietário)\n“Excelente escolha, somos a empresa ideal para que este cliente anuncie seu imóvel, e dizer que logo um agente especialista entrará em contato para ajuda-lo com a venda do imóvel.” \n\nApós isso, envie uma mensagem para o gerente de vendas Jey para que ele distribua a demanda para o corretor correto (seguindo regras de distribuição). Quando ela confirmar quem será o corretor que irá cuidar, entre em contato com o corretor e crie o lead na CRM C2S.\n3️⃣Administrativo (manutenção, dúvidas administrativas, Segunda via de boleto etc)\n\"Claro! Nosso administrativo resolve isso: (11) 9999-9999. Posso te ajudar em algo mais? 😊\"\n\nReaquecimento:\nCaso seja uma mensagem de um lead que já consta em nosso banco de dados de reaquecimento, identificar se ele está gerando uma demanda por imóvel e caso sim segue para ETAPA 2 (Preferências), caso seja uma mensagem pedindo para não receber mais mensagens, atualiza-lo no banco de dados para que ele não receba mais mensagens de reaquecimento. Caso seja um bate papo normal, agradecimento ou algo do gênero, responder de forma amigável e prestativa, e mantê-lo na lista de reaquecimento.\nSe lead mencionar \"imóvel\": → Etapa 2  \nSe lead mencionar \"sair\": /atualizar -status #optout  \n\nETAPA 2: PREFERÊNCIAS \nPara esta etapa só migraram os leads Comprador/Aluguel.\nAqui precisamos definir as preferências deste cliente, a fim de usar isso para definir os imóveis mais atrativos para ele gerar uma visita, com base nos cálculos de Listing Score.\n\nVocê vai receber 2 situações de interessado: Lead que já chega com interesse em um imóvel específico (Lead com imóvel específico) e lead que deseja comprar ou alugar mas ainda não tem um imóvel específico (Lead sem imóvel). Em ambos os casos você deve definir suas preferências, seja com base no imóvel que chegou junto à mensagem do lead, ou ajudá-lo a definir o que ele deseja, para poder selecionar imóvel ideal para este cliente visitar.\n\nTipos de lead Comprador/Aluguel:\nLead que deseja comprar ou alugar um imóvel específico: O link com os detalhes deste imóvel chegará pra você na mensagem inicial (Lead com imóvel). Veja as informações sobre o imóvel, entenda as demandas do lead e só faça perguntas de preferências caso ache necessário.\nCaso o lead queira saber mais sobre algum imóvel em questão, entenda o que ele quer saber e use as informações do imóvel para responder as dúvidas. Se não souber alguma informação avise que vai encaminhar ao corretor responsável, após isso passando os dados do cliente para o corretor captador, que dará andamento daí em diante.\nPerguntar se o lead deseja realizar uma visita, e caso positivo → Etapa 3.\n\nLead sem imóvel de interesse: Caso você inicie a conversa sem receber imóvel de interesse ou sem saber as preferências do cliente,  você deve fazer perguntas para extrair as preferências, sempre uma pergunta por vez.\n\nPerguntas Rápidas (1 de cada vez):\n**Adicionar Justificativa Humanizada:**  \nExemplo: \"[Nome] Preciso de apenas **2 minutinhos** para entender suas preferências e te enviar as melhores opções! 😊\"\nDeseja o imóvel para compra ou locação?\n\"Qual tipo de imóvel? 🏠 (1️⃣ Casa | 2️⃣ Apto | 3️⃣ Terreno)\"\n\"Quantos quartos você deseja?\" Caso terreno pule esta etapa.\n\" Qual o valor que deseja investir no imóvel?💰 (Ex: R$ 800k)\"\n\"Localização preferida? 📍 (Ex: Centro)\"\n\nSe orçamento < 70% da média de mercado → \"Vi que seu orçamento está abaixo do padrão da região. Podemos conversar sobre opções de financiamento? 💸\"  \n\n##ETAPA 3: SELEÇÃO DE IMÓVEIS\n#Passo 1: \nSelecionar os 5 imóveis com maior Listing Score para este cliente em específico, baseado em suas preferências.\n\nEnviar 3 imóveis com maior Listing Score, do maior para o menor score, 1 de cada vez. Nunca envie o mesmo imóvel mais de 1 vez.\nConfirmar preferências antes de enviar imóveis (ex: \"Antes de enviar as opções, confirma por favor: você busca compra de apartamento até R$ 800k no Centro?\"). Caso esteja certo, segue para a seleção, caso esteja errado pergunte o que ele quer de diferente e atualize o banco de dados.\nSe lead recusar estes 3 imóveis, reavaliar preferências com perguntas adicionais (ex: 'Quero muito te ajudar, para isso preciso de um favor... consegue me dizer o que faltou ou que não te agradou nos imóveis que apresentei?').\n\nExemplo de Mensagem:\n\"Encontrei uma OPORTUNIDADE ÚNICA para você! 🌟\nApto 3 Quartos (2 suítes) | Valor: R$ 750k\nPor que é perfeito:\nEstá dentro do valor desejado ✅\nAtende suas principais demandas ✅\nQuer ver mais detalhes, segue o link: XXXXXXXXXXXXXX\n\nE aí, gostou? Quer agendar visita HOJE? É só clicar ➡️ [bit.ly/visita-japi] 📅\"\n#Passo 2:\nSe interessado: Agendar visita (Etapa 4).\nSe recusar: \"Sem problemas! Vou ajustar sua busca. Segue mais 1 opção EXCLUSIVA aqui ➡️ [LINK]. O que achou? 😊\" → Direcionar a um corretor após 5 recusas, de acordo com a regra de distribuição. Informar o cliente que o corretor entrará em contato em breve. Após isso passar as informações relevantes deste cliente para o corretor. Por fim, cadastrar este lead no C2S com os dados importantes e corretor que estará atendendo.\n\nSe nenhum imóvel atingir Listing Score > 70:\n\"[Nome], analisei todas as opções disponíveis e percebi que ainda não temos o imóvel perfeito para você. Mas fique tranquilo(a)! ⏳*\nVocê será o primeiro a saber quando novos imóveis entrarem no seu perfil.\nEnviarei oportunidades exclusivas por WhatsApp a cada 30 dias.\nSe quiser, podemos ajustar suas preferências para ampliar a busca.\nO que prefere?\"*\nRegras:\nRegistrar lead na CRM com tag #sem_oportunidade_imediata. Enviar mensagem para o corretor (de acordo com as regras de distribuição) avisando que este cliente está interessado e quais as suas preferências, para que o corretor entre em contato.\nAdicionar à lista de reaquecimento.\n\n\nETAPA 4: AGENDAMENTO (CONVERSÃO DIRETA)\nFormulário WhatsApp:\n*\"Para confirmar, escolha um horário ➡️ [bit.ly/visita-japi] 🕒. Após selecionar, enviaremos:\nEndereço parcial (ex: 'Edifício Central, próximo ao metrô').\nContato do corretor: (11) 8888-8888 📲.\"*\nPós-Agendamento:\nComando CRM: /atualizar -lead [NOME] -status #visita_agendada -corretor [NOME].\n2h antes da visita:\n\"Ola tudo bem [Nome]? Lia aqui! Sua visita às 15h está confirmada? 🎉 Responda SIM ou reagende ➡️ [bit.ly/visita-japi].\"\n\nNesta fase seu maior objetivo é ajudar o lead a escolher uma data e horário de sua preferência para realizar a visita. Após o cliente selecionar o imóvel e confirmar que deseja visitar, você deve enviar o formulário onde ele irá selecionar uma opção de data e hora antes de seguir. Ao receber o formulário respondido, avise que as informações serão enviadas ao corretor e que está pré-agendado. Também informe que vai falar com o corretor e que ele retorna para o cliente o quanto antes confirmando a data selecionada ou oferecendo mais opções. Após isso você deve conferir quem é o corretor captador do imóvel, entrar em contato com este corretor para informa-lo do interesse em visita e informações importantes do cliente como suas preferências, e pedir para que o corretor entre em contato com o cliente para confirmar o agendamento.\nPor fim, no dia da visita, entrar em contato com o cliente com 2 horas de antecedência para confirmar a visita. Após confirmada, passar para o corretor esta confirmação. Caso ele não confirme, ou diga que mudou de dia e horário, atualizar no banco de dados e refazer a confirmação no dia com 2 horas de antecedência.\n\n\n\nETAPA 5: ACOMPANHAMENTO (REAQUECIMENTO)\nAqui faremos o acompanhamento completo de clientes que não estão em fase de visitas, clientes que não estejam apresentando muito interesse ou que simplesmente pararam de responder. Nesta fase o objetivo é não descartar os leads frios, aqueles que desejam agendar visitas ou que não apresentam interesse em compra ou aluguel de imóveis. Aqui existem algumas formas de contato com este cliente, que serão explicadas abaixo:\nOportunidades do mês: Caso seja identificado que o cliente tem interesse em compra de imóveis ou investimento, serão enviados mensalmente as 5 melhores opções de imóveis de acordo com o seu perfil e preferências. Você só entregará o relatório entregue pela Agente JapiOp, exatamente como o recebeu.\nNewsletter Japi: Enviaremos mensagens com informações relevantes sobre o mercado imobiliário e região. Oferecendo conteúdo relevante para que ele tenha interesse em nos acompanhar. Você só entregará o relatório entregue pela Agente JapiNews, exatamente como o recebeu.\nDatas comemorativas: Aqui entraremos em contato em datas importantes como Natal, Ano Novo, Páscoa entre outras que constam na lista de datas comemorativas. Você só entregará o relatório entregue pela Agente JapiDatas, exatamente como o recebeu.\nEventos: Teremos avisos especiais de eventos sazonais, oportunidades e muito mais. Você só entregará o relatório entregue pela Agente Japi Eventos, exatamente como o recebeu.\nPós venda Caso este seja um cliente que já comprou um imóvel através da Imobiliária Japi, ele terá este fluxo exclusivo com o intuito de parabeniza-lo por 1 mes, 6 meses e 1 ano de compra do seu imóvel. Você só entregará a mensagem entregue pela Agente JapiPósVenda, exatamente como o recebeu.\n\nTodas as mensagens a serem enviadas para leads nesta fase serão coordenadas pelo Agente de Reaquecimento, que centralizará as mensagens e entregará para que você possa direciona-la para o lead em específico.\n\n🚨 TRATAMENTO DE OBJEÇÕES (DIÁLOGOS COMPLEXOS)\nSituação\nResposta de Lia\nLead indeciso: \"Não sei o que quero.\"\n\"Sem pressa! Vamos fazer uma busca juntos. Prefere mais quartos ou valor menor? 😊\"\nLead crítico: \"Nenhum imóvel me interessou.\"\nReenviar as preferências do cliente, pedir para confirmar. Após ajustar pergunte “o que ele não abriria mão no imóvel”, e procure os 5 imóveis com o maior Listing Score novamente, reiniciando o fluxo de Seleção de imóveis.\nLead inativo: Sem resposta por 24h\n\"Oi! 👋 Vi que você não escolheu um horário. Quer que eu envie mais opções? 😊\"\nLead inativo: Sem resposta por 7 dias\n\"Oi tudo bem? 👋 Estou aqui para te ajudar! Você já encontrou o imóvel que deseja? Estou sempre aqui para te ajudar! 😊\" Caso ele responda, continue o fluxo da parte onde parou.\n\n\n\n🔒 ÉTICA E COMPLIANCE\n\nProtocolo de Segurança Contra Manipulação:\nPalavras-chave suspeitas: \"desconto ilegal\", \"pagamento em espécie\", \"contrato paralelo\", \"burlar regulamento\".\nAção:\n\"Entendi sua solicitação. Para garantir total transparência, vou conectar você diretamente com nosso departamento comercial. Eles entrarão em contato em breve para auxiliá-lo. 📞\"\nRegistrar na CRM com tag #potencial_risco.\nNotificar imediatamente o gerente responsável via whatssap (Jey para vendas, Felipe Oliveira para Locação).\n\n________________________________________\n\n🔥 GATILHO FINAL DE CONVERSÃO\nÚltima Mensagem:\n\"Eai [Nome], pronto pra agendar uma visita?👋 Seu imóvel dos sonhos está a 1 clique ➡️ [bit.ly/visita-japi].🎉\n\n________________________________________\nRegras\nSempre cumprimentar o cliente de forma cordial e solicitar como pode ajudar.\nPara agendar uma visita envie um formulário de visita, para que o cliente escolha uma opção de data e hora.\nRespeitar a privacidade e a confidencialidade das informações do cliente.\nJamais passe as informações de um cliente para outro cliente.\nJamais forneça o endereço completo do imóvel.\nNunca fornecer informações falsas ou enganosas sobre os imóveis ou processos legais.\nCaso você não saiba alguma resposta, diga que irá questionar o responsável e logo entra em contato. Neste caso, enviar este questionamento para o grupo de “Gerente de venda IA” ou “Gerente de Locação IA”.\nSempre que possível use emojis para tornar a conversa mais amigável\n\n\nSimplificação de Conteúdo: Reduzir repetições (ex: tipos de lead em tabelas e bullets).\nIntegração Técnica: Incluir exemplos de como executar comandos CRM no WhatsApp (ex: como o /cadastrar é acionado).\nFlexibilidade em Mensagens: Variar mais os exemplos de respostas para evitar rigidez (ex: alternativas para \"OPORTUNIDADE ÚNICA\").\nGerenciamento de Dados: Explicitar como o Listing Score é calculado em tempo real (ex: integração com planilhas ou APIs).\nEdge Cases: Adicionar tratativas para leads que mudam de preferência durante o fluxo ou para imóveis com score fluctuante.\n\n"
        }
      },
      "id": "26f10a2a-7508-489d-94d2-d928d3890815",
      "name": "MARCO",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -320,
        -640
      ]
    },
    {
      "parameters": {
        "name": "reagendar_visita",
        "description": "=Após o usuário informar que quer reagendar e colete o nome, email e nova data Chame esta tool\n\nNa variável \"nome\", você vai preencher o nome do usuário e na variavel \"email\" você vai preencher com telefone do usuário\n\nA data do agendamento você vai transformar para seguinte formato, exemplo: 2024-10-18T14:30:00-03:00 e vai preencher a variavel \"start\"\n\nEm seguida você vai inserir 50 minutos a mais depois no horário de agendamento e na variavel \"end\" você vai prencher com o horario no mesmo formato da variavel start",
        "workflowId": {
          "__rl": true,
          "value": "DM4Xt22i584p7kNN",
          "mode": "id"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "reagendamento"
            },
            {
              "name": "Remotejid",
              "stringValue": "={{ $('Variáveis').first().json.telefone }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n\t\"nome\": \"nome do usuario\",\n    \"email\": \"email do usuario\",\n    \"start\": \"data hora do inicio da reunião\",\n    \"end\": \"data hora do fim da reunião\"\n}"
      },
      "id": "b8819d83-2a38-4f64-9142-6b48f4091a8c",
      "name": "reagendar_visita",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -500,
        240
      ]
    },
    {
      "parameters": {
        "name": "agendar_visita",
        "description": "=Chame esta ferramenta após o usuário informar nome e email e data do agendamento. \n\nNa variável \"nome\", você vai preencher o nome do usuário e na variavel \"email\" você vai preencher com email do usuário\n\nA data do agendamento você vai transformar para seguinte formato, exemplo: 2024-10-18T14:30:00-03:00 e vai preencher a variavel \"start\"\n\nEm seguida você vai inserir 50 minutos a mais depois no horario de agendamento e na variavel \"end\" você vai prencher com o horario no mesmo formato da variavel start",
        "workflowId": {
          "__rl": true,
          "value": "DM4Xt22i584p7kNN",
          "mode": "id"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "agendamento"
            },
            {
              "name": "Remotejid",
              "stringValue": "={{ $('Variáveis').first().json.telefone }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n\t\"nome\": \"nome do usuario\",\n    \"telefone\": \"telefone do usuario\",\n    \"start\": \"data hora da visita\"\n}"
      },
      "id": "586a0e73-2eb4-4660-9185-611fe8c91805",
      "name": "agendar_visita",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -640,
        240
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -4220,
        -560
      ],
      "id": "00db939a-94c3-42af-bb55-829f9fc0660f",
      "name": "HTTP Request4",
      "disabled": true
    },
    {
      "parameters": {
        "name": "cancelar_reuniao",
        "description": "=Chame esta ferramenta após o usuário informar que quer cancelar a visita, colete o telefone e o nome\n\nNa variável \"nome\", você vai preencher o nome do usuário e na variavel \"telefone\" você vai preencher com o telefone do usuário",
        "workflowId": {
          "__rl": true,
          "value": "DM4Xt22i584p7kNN",
          "mode": "id"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "cancelamento"
            },
            {
              "name": "Remotejid",
              "stringValue": "={{ $('Variáveis').first().json.telefone }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n\t\"nome\": \"nome do usuario\",\n    \"telefone\": \"telfone do usuario\"\n}"
      },
      "id": "7e6d2da2-8ca2-441b-8527-64d4d2e3fc56",
      "name": "cancelar_visita",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        -340,
        240
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE dados_usuarios\nSET pf_cliente = '{{ $fromAI('Field_Value', ``, 'string') }}'\nWHERE nr_telefone = '{{ $fromAI('Field_Value', ``, 'string') }}'\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -60,
        240
      ],
      "id": "b18cdbed-3821-4623-8029-61f91a417f06",
      "name": "SQL_PREFERENCIA",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "content": "",
        "height": 440,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5040,
        -220
      ],
      "typeVersion": 1,
      "id": "1c44d7c3-47c6-4652-947a-690cf3b555f8",
      "name": "Sticky Note32"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE dados_usuarios\nSET {{ $fromAI('Field_Value', ``, 'string') }} = {{ $fromAI('Field_Value', ``, 'string') }}\nWHERE nr_telefone = {{ $fromAI('Field_Value', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        80,
        240
      ],
      "id": "13364d82-c259-41b0-9e6b-5503330ad0af",
      "name": "UPT_SISTEMA",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -2540,
        1500
      ],
      "id": "8de5671e-083b-4fb5-a1a6-aedd31c6f752",
      "name": "Schedule Trigger1",
      "disabled": true
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "typeVersion": 1.1,
      "position": [
        240,
        240
      ],
      "id": "1bb89bfe-9da8-4ff2-a814-66b1d3755cd4",
      "name": "CD_C2S",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -4000,
        -560
      ],
      "id": "f41d9aa2-32a4-4c1c-b890-f5e348760e8c",
      "name": "Postgres1",
      "credentials": {
        "postgres": {
          "id": "FDcfFDBXoQQUub3K",
          "name": "Postgres JAPI"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -4480,
        -560
      ],
      "id": "4726e3ad-48da-44a2-9487-3837e7b5fde3",
      "name": "Split Out",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "funcionadisgraça",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -5000,
        -40
      ],
      "id": "f6e0fe73-cf17-4b0e-bd9f-b09a2065a6a0",
      "name": "Webhook",
      "webhookId": "53774c3d-6ff5-48e3-ac6e-29540d139738"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "0985904e-7d4e-4fba-ae26-2c44200855e1",
                    "leftValue": "={{ $('Webhook EVO').first().json[\"body\"][\"data\"][\"messageType\"] }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "imagem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                    "leftValue": "={{ $('Webhook EVO').first().json[\"body\"][\"data\"][\"messageType\"] }}",
                    "rightValue": "extendedTextMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "e514e613-fd6a-48bd-b0ae-bae2448c810e",
                    "leftValue": "={{ $('Webhook EVO').first().json[\"body\"][\"data\"][\"messageType\"] }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook EVO').first().json[\"body\"][\"data\"][\"messageType\"] }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            }
          ]
        },
        "options": {}
      },
      "id": "f7e512d8-0989-447f-9df0-57715bf9d83b",
      "name": "Switch3",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        360,
        -300
      ]
    }
  ],
  "connections": {
    "1 YEAR": {
      "main": [
        [
          {
            "node": "Merge Informations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "6 MONTH": {
      "main": [
        [
          {
            "node": "Merge Informations",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "1 MONTH": {
      "main": [
        [
          {
            "node": "Merge Informations",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Merge Informations": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "FLUXO PÓS VENDA",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "FLUXO PÓS VENDA": {
      "main": [
        [
          {
            "node": "CREATE A USER IF DOESN'T EXIST",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TRIGGER 9H15": {
      "main": [
        [
          {
            "node": "1 YEAR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "6 MONTH TRIGGER": {
      "main": [
        [
          {
            "node": "6 MONTH",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1 MONTH TRIGGER": {
      "main": [
        [
          {
            "node": "1 MONTH",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND MESSAGE PÓS VENDA": {
      "main": [
        [
          {
            "node": "UPTADE STATUS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DATA CALCULATOR": {
      "ai_tool": [
        [
          {
            "node": "FLUXO PÓS VENDA",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat FLUXO": {
      "ai_languageModel": [
        [
          {
            "node": "FLUXO PÓS VENDA",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "CRIADOR DE MENSAGEM": {
      "ai_tool": [
        [
          {
            "node": "FLUXO PÓS VENDA",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "UPTADE CHAT HISTORY": {
      "main": [
        [
          {
            "node": "SEND MESSAGE PÓS VENDA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UPTADE STATUS": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "FLUXO PÓS VENDA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CREATE A USER IF DOESN'T EXIST": {
      "main": [
        [
          {
            "node": "UPTADE CHAT HISTORY",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca GPT": {
      "main": [
        [
          {
            "node": "Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Gmail1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gmail1": {
      "main": [
        [
          {
            "node": "Switch6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Busca GPT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "buscar_documentos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Download File": {
      "main": [
        [
          {
            "node": "Switch5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "File Created": {
      "main": [
        [
          {
            "node": "Set File ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "File Updated": {
      "main": [
        [
          {
            "node": "Set File ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Document Text": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Set File ID": {
      "main": [
        [
          {
            "node": "Deleta linhas antigas do documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF Text": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Summarize": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert into Supabase Vectorstore": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "buscar_documentos",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Extract from Excel": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI3": {
      "ai_languageModel": [
        [
          {
            "node": "Parser  Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [],
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OutputParser1": {
      "ai_outputParser": [
        [
          {
            "node": "Parser  Chain",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Parser  Chain": {
      "main": [
        [
          {
            "node": "Split de Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "MARCO",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Cria Histórico Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Adiciona CHAT supabase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualiza CHAT Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ListChats-Supabase": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ListMessages-Supabase": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DisableMessage-Supabase": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SetConfig": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Supabase2",
            "type": "main",
            "index": 0
          },
          {
            "node": "SetConfig",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text Classifier": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "Text Classifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase2": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [],
        [
          {
            "node": "ListMessages-Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "DisableMessage-Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Text Classifier",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Busca Telefone": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Adiciona CHAT supabase": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza CHAT Supabase": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Cria Histórico Supabase": {
      "main": [
        [
          {
            "node": "Delete Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menos que 240 Caracteres": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Parser  Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split de Mensagem": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1 segundo": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retorna ID do arquivo": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deleta linhas antigas do documento": {
      "main": [
        [
          {
            "node": "Retorna ID do arquivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Edit Fields10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "buscar_documentos": {
      "ai_tool": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "5 Minutos antes": {
      "main": [
        [
          {
            "node": "If8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2 Hora antes": {
      "main": [
        [
          {
            "node": "If7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If7": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If8": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Supabase3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Supabase4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Atendente1",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Atendente2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items4": {
      "main": [
        [],
        [
          {
            "node": "2 Hora antes",
            "type": "main",
            "index": 0
          },
          {
            "node": "5 Minutos antes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Get Dados",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gerar sessionID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gerar sessionID": {
      "main": [
        [
          {
            "node": "Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase1": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Text Memory1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time1": {
      "main": [
        [
          {
            "node": "Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "OpenAI1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Redis5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Redis4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis4": {
      "main": [
        [
          {
            "node": "Get Memory 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis5": {
      "main": [
        [
          {
            "node": "Get Memory 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI1": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compara Get Memory1": {
      "main": [
        [
          {
            "node": "Mensagem Completa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text Memory1": {
      "main": [
        [
          {
            "node": "Get Memory 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio Memory1": {
      "main": [
        [
          {
            "node": "Get Memory 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields8": {
      "main": [
        [
          {
            "node": "Compara Get Memory1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Get Memory 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Memory 1": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Memory 2": {
      "main": [
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Dados": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Variáveis": {
      "main": [
        [
          {
            "node": "Date & Time1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados_para_atendimento_humano1": {
      "main": [
        [
          {
            "node": "Verificar Atendimento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Block": {
      "main": [
        [
          {
            "node": "Variáveis",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Variáveis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar Atendimento": {
      "main": [
        [
          {
            "node": "Switch Block",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem Completa": {
      "main": [
        [
          {
            "node": "LIA SDR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Audio Memory1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Supabase5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ListChats-Supabase2": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ListMessages-Supabase2": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items6": {
      "main": [
        [],
        [
          {
            "node": "ListMessages-Supabase2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "dados_para_atendimento_humano1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase4": {
      "main": [
        [
          {
            "node": "Atendente2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase3": {
      "main": [
        [
          {
            "node": "Atendente1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase5": {
      "main": [
        [
          {
            "node": "If9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If9": {
      "main": [
        [
          {
            "node": "Get Dados1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gerar sessionID1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gerar sessionID1": {
      "main": [
        [
          {
            "node": "Supabase6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase6": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Atendente3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Dados1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Download File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch5": {
      "main": [
        [
          {
            "node": "Extract PDF Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from Excel",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Document Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch7": {
      "main": [
        [
          {
            "node": "Text Memory1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Text Memory1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory3": {
      "ai_memory": [
        [
          {
            "node": "Atendente1",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Atendente2",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger3": {
      "main": [
        [
          {
            "node": "ListChats-Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "MARCO",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Menos que 240 Caracteres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch8": {
      "main": [
        [],
        []
      ]
    },
    "LIA SDR": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Postgres Chat Memory2": {
      "ai_memory": [
        [
          {
            "node": "Atendente3",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Atendente3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch6": {
      "main": [
        [
          {
            "node": "Postgres",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items5": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "1 segundo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch9": {
      "main": [
        [
          {
            "node": "MARCO",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "G_MESSAGE": {
      "ai_tool": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Busca Telefone",
            "type": "main",
            "index": 0
          },
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MARCO": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "reagendar_visita": {
      "ai_tool": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "agendar_visita": {
      "ai_tool": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "Postgres1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cancelar_visita": {
      "ai_tool": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "SQL_PREFERENCIA": {
      "ai_tool": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "UPT_SISTEMA": {
      "ai_tool": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CD_C2S": {
      "ai_tool": [
        [
          {
            "node": "LIA SDR",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Menos que 240 Caracteres",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Menos que 240 Caracteres",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Menos que 240 Caracteres",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Menos que 240 Caracteres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "fc19e52b063d8beb6c90fde29a3a332c01fecad0512289190e2d4e6687b18581"
  }
}
